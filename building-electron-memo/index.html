<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=5" name="viewport"><meta content="yes" name="mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><script>(()=>{let e="/cnfonts.js?rDuukLHQ",t=document,n=navigator.serviceWorker,r=!1;var a;(r=n&&(n.register(e,{scope:"/"}).then(e=>e.update()),a=n.controller)&&a.scriptURL.endsWith(e)&&"activated"===a.state?!0:r)?((a=t.createElement("link")).rel="stylesheet",a.href="/fontchan/rDuukLHQ.css",a.blocking="render",t.head.appendChild(a)):((a=t.createElement("script")).src=e,a.onload=()=>$fontchan.injectCss(),t.head.appendChild(a))})()</script><title>Building Electron From Scratch</title><meta itemprop="title" content="Building Electron From Scratch - hsfzxjy 的博客"><meta itemprop="og:title" content="Building Electron From Scratch - hsfzxjy 的博客"><meta itemprop="image" content="https://i.hsfzxjy.site/avatar-for-hsfzxjy.jpg"><meta itemprop="og:image" content="https://i.hsfzxjy.site/avatar-for-hsfzxjy.jpg"><meta itemprop="description" content="Last night I started a journey to build Electron complete..."><meta itemprop="og:type" content="website"><link rel="stylesheet" href="/dist/css/style.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="alternate" type="application/rss+xml" href="/rss.xml"></head><body><nav class="nav"><span class="nav__toggler"><span class="nav__toggler-bar bar1"></span><span class="nav__toggler-bar bar2"></span><span class="nav__toggler-bar bar3"></span></span><span class="nav__core"><div class="nav__logo"><img src="/avatar.webp" loading="lazy"></div><a href="/" lang="zh" class="nav__brand">hsfzxjy</a></span><span class="nav__togglerClose"><span class="nav__togglerClose-circle"></span><span class="nav__togglerClose-bar bar1"></span><span class="nav__togglerClose-bar bar2"></span></span><div class="nav__pathIndicator"><a href="/categories/Tech/">Tech</a></div></nav><main class="mainContainer"><div lang="en" class="post post-page"><h1 lang="en" class="post__title">Building Electron From Scratch</h1><div class="post__meta font__ui">2023-07-07 | <span class="post__meta-categories"><a href="/categories/Tech/">Tech</a><a href="/categories/Memo/"> Memo</a></span></div><div class="post__content font__body"><p>Last night I started a journey to build <a target="_blank" rel="noopener" href="https://github.com/electron/electron">Electron</a> completely from the ground up, for investigating <a target="_blank" rel="noopener" href="https://github.com/microsoft/vscode/issues/187126">a subtle issue</a> in VSCode.</p><p>The journey appears as a really painful challenge for my disk storage as well as network condition. It has downloaded around 30 GiB contents from the Internet, and occupied 55 GiB of storage space on the disk after the binary file was fully compiled. I will suggest anyone to go through this journey should place his workspace on an SSD, and adopt a network proxy of good quality if in China.</p><p>Albeit it occupies a bunch of resources greedily, the Electron team provides a command line tool <code>e</code> (<a target="_blank" rel="noopener" href="https://github.com/electron/build-tools">Electron build-tools</a>) to hopefully simplify the building process. The guidance leading to this tool, however, is not obvious enough on the <a target="_blank" rel="noopener" href="https://www.electronjs.org/docs/latest/development/build-instructions-gn#build-tools">doc page</a>. I’ve wasted two or three hours following the instructions in the doc that explicitly invokes <code>gclient</code> or <code>gn</code> or <code>ninja</code>, which yet resulted in a bunch of errors and a hell of mess. So here’s the first advice – <strong>DO NOT follow any instructions after section “GN files” in <a target="_blank" rel="noopener" href="https://www.electronjs.org/docs/latest/development/build-instructions-gn#gn-files">this page</a>. Just go ahead to use <a target="_blank" rel="noopener" href="https://github.com/electron/build-tools">Electron build-tools</a>!</strong></p><p>Things become easier once you’ve learned the existence of <a target="_blank" rel="noopener" href="https://github.com/electron/build-tools">Electron build-tools</a>. To install the tool you only have to type one command</p><div class="gk-code hljs" data-gk-id="BLOCK1"><div class="gk-code-display"><pre><span class="line"><span class="hljs-meta prompt_">$ </span><span class="language-bash">npm i -g @electron/build-tools</span></span><br></pre></div></div><p class="par">This package manages for you all the necessary stuffs to build Electron, including <a target="_blank" rel="noopener" href="https://commondatastorage.googleapis.com/chrome-infra-docs/flat/depot_tools/docs/html/depot_tools_tutorial.html#_setting_up">Depot Tools</a> for source code management and Rust/clang toolchains for building, which are exposed as a single command <code>e</code>. To fetch the source code and build Electron in one go, you need to run</p><div class="gk-code hljs" data-gk-id="BLOCK2"><div class="gk-code-display"><pre><span class="line"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-comment"># you&#x27;d better add this to .bashrc</span></span></span><br><span class="line"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">export</span> GIT_CACHE_PATH=<span class="hljs-string">&quot;/path/to/git-cache&quot;</span></span></span><br><span class="line"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$GIT_CACHE_PATH</span></span></span><br><span class="line"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-comment"># tell depot_tools not to update itself</span></span></span><br><span class="line"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">export</span> DEPOT_TOOLS_UPDATE=0</span></span><br><span class="line"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-comment"># setup network proxy if necessary</span></span></span><br><span class="line"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">export</span> http_proxy=... https_proxy=...</span></span><br><span class="line"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-comment"># go to your workspace</span></span></span><br><span class="line"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$WORKSPACE</span> &amp;&amp; <span class="hljs-built_in">cd</span> <span class="hljs-variable">$WORKSPACE</span></span></span><br><span class="line"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-comment"># fetch and build Electron!</span></span></span><br><span class="line"><span class="hljs-meta prompt_">$ </span><span class="language-bash">e init --root=<span class="hljs-variable">$PWD</span> --bootstrap testing --fork hsfzxjy/electron --goma none</span></span><br></pre></div></div><p class="par">Some notes on these command:</p><ol><li><code>depot_tools</code> respect the environment variable <code>GIT_CACHE_PATH</code> to cache up git database for all fetched dependencies. The variable is highly recommended to set as it could significantly speed up file synchronization next time.</li><li><code>depot_tools</code> will automatically check updates for itself and I don’t like it. Disable this behavior via <code>DEPOT_TOOLS_UPDATE=0</code>.</li><li><code>depot_tools</code> respect the <code>http_proxy</code> and <code>https_proxy</code> for network proxy, but <code>proxychains</code> might fail wierdly.</li><li>The flag <code>--goma none</code> is necessary if you build Electron on your personal computer without using distributed building facility like Goma. Otherwise the building process will emit errors in the middle.</li></ol><br><blockquote><p class="cc"><b>Author:</b> hsfzxjy.<br><b>Link:</b> <span class="cc-link"></span>.<br><b>License:</b> <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/">CC BY-NC-ND 4.0</a>.<br>All rights reserved by the author.<br>Commercial use of this post in any form is <b>NOT</b> permitted.<br>Non-commercial use of this post should be attributed with this block of text.</p></blockquote><script>!function(){var n=document.querySelector("span.cc-link");n&&(n.innerHTML='<a href="'+location.href+'">'+location.href+"</a>")}()</script></div><div class="post__tags"><a href="/tags/Git/">Git</a><a href="/tags/Electron/">Electron</a></div><div class="post-nav"><a href="/coding-ceremory/" class="pre">«代码的仪式</a><a href="/commutable-family-names-1/" class="next">中式亲属称谓研究之一：构建半群»</a></div><div id="disqus_thread"><div id="no-comment"><h2>OOPS!</h2><span>A comment box should be right here...</span><span>But it was gone due to network issues :-(</span><span>If you want to leave comments, make sure you have access to&nbsp;<a target="_blank" rel="noopener" href="https://disqus.com">disqus.com</a>.</span></div><script>var disqus_shortname="hsfzxjy",disqus_identifier="building-electron-memo/",disqus_title="Building Electron From Scratch",disqus_url="https://i.hsfzxjy.site/building-electron-memo/";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.defer=!0,e.src="https://"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("body")[0]||document.getElementsByTagName("head")[0]).appendChild(e),e.onerror=function(){document.getElementById("no-comment").classList.add("show")}}()</script><script id="dsq-count-scr" src="//hsfzxjy.disqus.com/count.js" async defer></script></div></div></main><section class="aside__group"><span class="aside__btn"><div lang="zh" class="github-btn"><a href="#" rel="noopener noreferrer" target="_blank" class="gh-btn"><span class="gh-ico"></span><span class="gh-text">FOLLOW ME</span></a><a href="#" rel="noopener noreferrer" target="_blank" class="gh-count"></a></div><script>window.GH_BUTTON={username:"hsfzxjy"}</script></span><aside class="aside__left"><div class="aside__menuList"><span class="aside__menuList-item__icon"><i class="icon-home"></i></span><a href="/" class="aside__menuList-item"><span lang="zh" class="font__ui">首页 / Home</span></a><span class="aside__menuList-item__icon current"><i class="icon-embed2"></i></span><a href="/categories/Tech/" class="aside__menuList-item current"><span lang="zh" class="font__ui">科技 / Tech</span></a><span class="aside__menuList-item__icon"><i class="icon-android"></i></span><a href="/categories/Soliloquy/" class="aside__menuList-item"><span lang="zh" class="font__ui">呓语 / Soliloquy</span></a><span class="aside__menuList-item__icon"><i class="icon-leaf"></i></span><a href="/categories/Life/" class="aside__menuList-item"><span lang="zh" class="font__ui">生活 / Life</span></a><span class="aside__menuList-item__icon"><i class="icon-bookmarks"></i></span><a href="/categories/Memo/" class="aside__menuList-item"><span lang="zh" class="font__ui">速记 / Memo</span></a><span class="aside__menuList-item__icon"><i class="icon-books"></i></span><a href="/categories/Series/" class="aside__menuList-item"><span lang="zh" class="font__ui">连载 / Series</span></a><span class="aside__menuList-item__icon"><i class="icon-sigma"></i></span><a href="/works/" class="aside__menuList-item"><span lang="zh" class="font__ui">项目 / Projects</span></a><span class="aside__menuList-item__icon"><i class="icon-earth"></i></span><a href="/links/" class="aside__menuList-item"><span lang="zh" class="font__ui">友链 / Links</span></a><span class="aside__menuList-item__icon"><i class="icon-wink"></i></span><a href="/about/" class="aside__menuList-item"><span lang="zh" class="font__ui">关于 / About</span></a><span class="aside__menuList-item__icon"><i class="icon-history"></i></span><a href="/aggr/" class="aside__menuList-item"><span lang="zh" class="font__ui">索引 / Index</span></a><span class="aside__menuList-item__icon"><i class="icon-rss2"></i></span><a href="/rss.xml" class="aside__menuList-item"><span lang="zh" class="font__ui">订阅 / RSS</span></a></div></aside><aside class="aside__right"></aside></section><div id="footer" style="text-align:center" lang="zh" class="font__ui">© <a href="/" rel="nofollow">hsfzxjy 的博客.</a>&nbsp;Powered by&nbsp;<a rel="nofollow" target="_blank" href="https://hexo.io">Hexo.</a>&nbsp;<a rel="nofollow" target="_blank" href="https://github.com/hsfzxjy/byak-hexo">Theme</a>&nbsp;by&nbsp;<a rel="nofollow" target="_blank" href="https://github.com/hsfzxjy">hsfzxjy</a>.<div style="margin-top:10px"><a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44011202001249" style="display:inline-block;text-decoration:none;height:20px;line-height:20px"><img src="/img/beian.png" style="float:left" loading="lazy"><span style="float:left;height:20px;line-height:20px;margin:0 0 0 5px;color:#939393">粤公网安备44011202001249号</span></a><a target="_blank" style="display:inline-block;text-decoration:none;height:20px;line-height:20px" href="http://beian.miit.gov.cn/"><span style="float:left;height:20px;line-height:20px;margin:0 0 0 5px;color:#939393">粤ICP备2020075702号-1</span></a></div></div></body><script src="/dist/js/main.js" async defer></script></html>