<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=5" name="viewport"><meta content="yes" name="mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><title>Tech | hsfzxjy 的博客</title><link rel="stylesheet" href="/dist/css/style.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="alternate" type="application/rss+xml" href="/rss.xml"></head><body><nav class="nav"><span class="nav__toggler"><span class="nav__toggler-bar bar1"></span><span class="nav__toggler-bar bar2"></span><span class="nav__toggler-bar bar3"></span></span><span class="nav__core"><div class="nav__logo"><img src="/avatar.webp" loading="lazy"></div><a href="/" lang="zh" class="nav__brand">hsfzxjy</a></span><span class="nav__togglerClose"><span class="nav__togglerClose-circle"></span><span class="nav__togglerClose-bar bar1"></span><span class="nav__togglerClose-bar bar2"></span></span><div class="nav__pathIndicator"><a href="/categories/Tech/">Tech</a></div></nav><main class="mainContainer"><div class="post-list"><article lang="en" class="post"><div class="post__title-block"><h1 class="post__title"><a href="/some-notes-on-kotlin-coroutines/">Some Notes on Kotlin Coroutines</a></h1><span class="post__lang-tag font__ui">en</span></div><div lang="zh" class="post__meta font__ui">2023-05-10 | <span class="post__meta-categories"><a href="/categories/Tech/">Tech</a></span></div><div data-post-id="e27a21a5356fefbba79b5a388e5d1cc8f2ba3991f2bc4804cecf27b46dd550c2" class="post__content font__body"><p>This post is written to dictate some opinionated explanation that dispels my confusion to Kotlin coroutines during learning.</p></div><div lang="zh" class="post__readmore font__ui"><a href="/some-notes-on-kotlin-coroutines/">READ MORE</a></div></article><article lang="en" class="post"><div class="post__title-block"><h1 class="post__title"><a href="/diving-from-the-cuda-error-804-into-a-bug-of-libnvidia-container/">Diving from the CUDA Error 804 into a bug of libnvidia-container</a></h1><span class="post__lang-tag font__ui">en</span></div><div lang="zh" class="post__meta font__ui">2023-03-19 | <span class="post__meta-categories"><a href="/categories/Tech/">Tech</a></span></div><div data-post-id="7fd82cdfbc9fbe94a914f77e899ca219b3805a706be05911d4d43ddaffa2a32f" class="post__content font__body"><p>Several users reported to encounter <code>&quot;Error 804: forward compatibility was attempted on non supported HW&quot;</code> during the usage of some customized PyTorch docker images on our GPU cluster.</p><p>At first glance I recognized the culprit to be a version mismatch between installed driver on the host and required driver in the image. The corrupted images as they described were built targeting <code>CUDA == 11.3</code> with a corresponding driver version <code>== 465</code> , while some of our hosts are shipped with driver version <code>460</code>. As a solution I told them to downgrade the targeting CUDA version by choosing a base image such as <code>nvidia/cuda:11.2.0-devel-ubuntu18.04</code>, which indeed well solved the problem.</p><p>But later on I suspected the above hypothesis being the real cause. An observed counterexample was that another line of docker images targeting even higher CUDA version would run normally on those hosts, for example, the latest <code>ghcr.io/pytorch/pytorch:2.0.0-devel</code> built for <code>CUDA == 11.7</code>. This won’t be the case if CUDA version mismatch truly matters.</p><p>Afterwards I did a bit of research concerning the problem and learnt some interesting stuff which this post is going to share. In short, <strong>the recently released minor version compatibility allows applications built for newer CUDA to run on machines with some older drivers, but libnvidia-container doesn’t correcly handle it due to <a target="_blank" rel="noopener" href="https://github.com/NVIDIA/libnvidia-container/issues/138">a bug</a> and eventually leads to such an error</strong>.</p><p>Towards thorough comprehension, this post will first introduce the constitution of CUDA components, following with the compatibility policy of different components, and finally unravel the bug and devise a workaround for it. But before diving deep, I’ll give two Dockerfile samples to illustrate the problem.</p></div><div lang="zh" class="post__readmore font__ui"><a href="/diving-from-the-cuda-error-804-into-a-bug-of-libnvidia-container/">READ MORE</a></div></article><article lang="en" class="post"><div class="post__title-block"><h1 class="post__title"><a href="/gpg-and-github-interoperation/">Modern Cryptography, GPG and Integration with Git(hub)</a></h1><span class="post__lang-tag font__ui">en</span></div><div lang="zh" class="post__meta font__ui">2023-01-03 | <span class="post__meta-categories"><a href="/categories/Tech/">Tech</a></span></div><div data-post-id="a4feb1131ed62110dc30968667c4bbad4567554efface2551cc406da5811e5db" class="post__content font__body"><p><a target="_blank" rel="noopener" href="https://gnupg.org/">GPG</a> (the GNU Privacy Guard) is a complete and free implementation of the <a target="_blank" rel="noopener" href="https://www.openpgp.org/">OpenPGP</a> standard. Based on various mature algorithms to select from, GPG acts as a convenient tool for daily cryptographic communication.</p><p>GPG has two primary functionalities: (1) it encrypts and signs your data for secure transfering and verifiable information integrity, and (2) it features a versatile key management system to construct and promote web of trust. GPG also has a well-designed command line interface for easy integration with other applications such as git.</p><p>This article is going to briefly elaborate some key concepts and usage of GPG, and then present demonstration to cryptographically sign git commits with the help of GPG.</p></div><div lang="zh" class="post__readmore font__ui"><a href="/gpg-and-github-interoperation/">READ MORE</a></div></article><article lang="en" class="post"><div class="post__title-block"><h1 class="post__title"><a href="/move-ubuntu-root-partition/">Move the Root Partition of Ubuntu</a></h1><span class="post__lang-tag font__ui">en</span></div><div lang="zh" class="post__meta font__ui">2022-11-13 | <span class="post__meta-categories"><a href="/categories/Tech/">Tech</a></span></div><div data-post-id="c5e13214f74ea716a4d16f43b156c2d5546041c9ea1be085bdf106aa0cedaf25" class="post__content font__body"><p>A few days ago, I decided to shrink the footprint of the Windows system on my laptop and reallocate the freed-up disk space to Ubuntu, which I use alongside it. Since I primarily rely on Ubuntu for programming and web browsing, I’ve rarely booted into the OEM-shipped Windows since purchasing the laptop. Windows occupies a significant portion of my SSD, and reclaiming that space allows for better use rather than letting it sit idle.</p><div class="gk-code hljs" data-gk-id="BLOCK1"><div class="gk-code-display"><pre><span class="line">#gk:immersive</span><br><span class="line">(before)</span><br><span class="line">| --- Windows C: (256 GB) --- | --- Ubuntu / (256 GB) --- |</span><br><span class="line">(after)</span><br><span class="line">| --- Windows C: (120 GB) --- | --- Ubuntu / (392 GB) --- |</span><br></pre></div></div></div><div lang="zh" class="post__readmore font__ui"><a href="/move-ubuntu-root-partition/">READ MORE</a></div></article><article lang="en" class="post"><div class="post__title-block"><h1 class="post__title"><a href="/a-new-programmer-kicks-a-roadblock/">A New Programmer Kicks a Roadblock</a></h1><span class="post__lang-tag font__ui">en</span></div><div lang="zh" class="post__meta font__ui">2022-09-20 | <span class="post__meta-categories"><a href="/categories/Tech/">Tech</a></span></div><div data-post-id="6ca12b0126709e68a6c02631118d4f0062378dddc9fc1baf07a7c7dff645f68f" class="post__content font__body"><p>The time I composed my first program can be back to my junior high school age. It was the first day of PC lesson, and everybody crowded to the computer classroom. We were told to learn “programming” there. The kids who were talented would be selected and trained for OI . Others instead would go to an ordinary class and learn something more general.</p><p>I was anxious. Before the time I had no concept of what “programming” is, nor had I ever gone through a <em>real</em> PC lesson. The PC lesson in my primary school barely taught anything. Over the time the teachers let us play games instead. I could type merely a dozen of characters per minute, since I’d never received a thorough typing training. I was ignorant of inside the metal box. I was a complete computer idiot.</p></div><div lang="zh" class="post__readmore font__ui"><a href="/a-new-programmer-kicks-a-roadblock/">READ MORE</a></div></article><article lang="en" class="post"><div class="post__title-block"><h1 class="post__title"><a href="/reversy-naming/">Reversy Naming</a></h1><span class="post__lang-tag font__ui">en</span></div><div lang="zh" class="post__meta font__ui">2022-06-21 | <span class="post__meta-categories"><a href="/categories/Tech/">Tech</a></span></div><div data-post-id="c98bc65f255bc3f7ab74b77dfac0172aa5f4e31debdfd24301fe4885c46fc0f5" class="post__content font__body"><p>I am always a dedicated fan of writing naturally readable code – by “naturally readable” I mean, one can read a line of code as if it were a sentence of English (or maybe other human languages). It’s believed that the practice encourages more self-explainable code, as the code reads more like a human-composed article, instead of some gibberish only recognizable by machine.</p><p>The practice recommends to name functions or variables following the word order of human language, for English that is, subjects come after verbs, and adjectives go before nouns that being modified. The samples below showcase how it guides naming in a program (please hold your opinions about the casing)</p><ul><li><code>append_to_list(lst, item)</code>. A function that appends an item to a list, which can read as “append to the list (specified by name <code>lst</code>) with the item”.</li><li><code>register_service_notifier(func)</code>. A function that registers another function as a service notifier, which can read as “register a service notifier with the function <code>func</code>“.</li><li><code>UserFollowersListView</code>. The name of a web component which is a list view to display followers for a user.</li></ul><p class="nomargin">It plays well and improves my developing experience most of the time, but there is no silver bullet, just like other practices or guidelines.Sometimes I found the readability even degrades. I kept skimming the lines and just couldn’t locate an item efficiently.</p></div><div lang="zh" class="post__readmore font__ui"><a href="/reversy-naming/">READ MORE</a></div></article><article lang="en" class="post"><div class="post__title-block"><h1 class="post__title"><a href="/invalid-pointer-will-bite-you/">Invalid Golang Pointers Can Bite You Even If You Don't Dereference</a></h1><span class="post__lang-tag font__ui">en</span></div><div lang="zh" class="post__meta font__ui">2022-04-19 | <span class="post__meta-categories"><a href="/categories/Tech/">Tech</a></span></div><div data-post-id="6321ba204d8e3785fa9e839f6466d9635d6df84cae1db4b69c9ae47414ec31e8" class="post__content font__body"><p>In Golang, if you coerce a <code>uintptr</code> variable into <code>unsafe.Pointer</code> (or further, to some <code>*T</code>), the linter will warn with the message <code>&quot;possible miuse of unsafe.Pointer&quot;</code>. This makes sense because the <code>uintptr</code> variable may contain an address that points to a piece of invalid memory, and dereferencing such a pointer is catastrophic (usually aborts the program).</p><p>I was always aware of the above discipline, but I thought it would be OK to hold the pointers but not dereference them. This is true in C/C++, but not for Golang, which I did not realize until recently.</p><p>In fact, <strong>the program can panic even if you just keep an invalid pointer on the stack!</strong></p></div><div lang="zh" class="post__readmore font__ui"><a href="/invalid-pointer-will-bite-you/">READ MORE</a></div></article><article lang="en" class="post"><div class="post__title-block"><h1 class="post__title"><a href="/a-bug-of-promoting-complex-trait-bounds-in-rust/">A Flaw of Promoting Complex Trait Bounds in Rust</a></h1><span class="post__lang-tag font__ui">en</span></div><div lang="zh" class="post__meta font__ui">2022-03-30 | <span class="post__meta-categories"><a href="/categories/Tech/">Tech</a></span></div><div data-post-id="d930f9d181e14eb75e7a8cfc361c7e69b1201e1467cc73a76fe37d6fe6d61e5a" class="post__content font__body"><p>Days ago, for some reason, I was trying to implement a function that can polymorphize over its return type. The solution is simple, but my brain was jammed at that time, trapped in some complicated typing tricks for hours.</p><p class="nomargin">During the struggling, I coincidently ran into something that is temporarily a flaw in the current Rust compiler implementation. In some cases, the compiler is not smart enough to promote known trait bounds, and we have to replicate them again and again. Although the problem is afterwards proved to be a useless “X-Y Problem”, I would still like to share the story.</p></div><div lang="zh" class="post__readmore font__ui"><a href="/a-bug-of-promoting-complex-trait-bounds-in-rust/">READ MORE</a></div></article><article lang="en" class="post"><div class="post__title-block"><h1 class="post__title"><a href="/initialize-pool-worker-with-individual-values/">Initialize Process Pool Worker with Individual Value</a></h1><span class="post__lang-tag font__ui">en</span></div><div lang="zh" class="post__meta font__ui">2022-03-21 | <span class="post__meta-categories"><a href="/categories/Tech/">Tech</a></span></div><div data-post-id="4452bc2ebcdbd64a4469b134fd2cc88f05f5a877f877a8a8ce2b9d3a929d6ece" class="post__content font__body"><p>There could be scenes when you are using <code>multiprocessing.pool.Pool</code> and you want to perform some initialization for each worker before tasks are scheduled via <code>Pool.map()</code> or something alike. For example, you create a pool of 4 workers, each for one GPU, and expect tasks scheduled on Worker-i to precisely utilize GPU-i. In this case, Worker-i should be initialized with env var <code>CUDA_VISIBLE_DEVICES=&lt;i&gt;</code> set.</p><p>To initialize spawned workers, the constructor of <code>Pool</code> provides two arguments concerning the job <sup id="fnref:1"><a href="#fn:1">1</a></sup> – <code>initializer</code> and <code>initargs</code>. <code>initializer</code> is expected to be a callable, and if specified, each worker process will call <code>initializer(*initargs)</code> when it starts.</p><div class="gk-code hljs" data-gk-id="BLOCK1"><div class="gk-code-display"><pre><span class="line"><span class="hljs-keyword">import</span> multiprocessing <span class="hljs-keyword">as</span> mp</span><br><span class="line"><span class="hljs-keyword">import</span> multiprocessing.pool <span class="hljs-keyword">as</span> mpp</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">def</span> <span class="hljs-title function_">worker</span>(<span class="hljs-params">arg1</span>):</span><br><span class="line">    <span class="hljs-built_in">print</span>(arg1)</span><br><span class="line"></span><br><span class="line">mpp.Pool(processes=<span class="hljs-number">2</span>, initializer=worker, initargs=(<span class="hljs-number">42</span>, ))</span><br><span class="line"><span class="hljs-comment"># 42</span></span><br><span class="line"><span class="hljs-comment"># 42</span></span><br></pre></div></div><p class="par">This is, however, slightly away from what we expect. The <code>initializer</code> is called with same arguments in each worker, while in our case, the arguments are expected to be different, like value <code>1</code> for Worker-0 and value <code>1</code> for Worker-1. There are two approaches to do the tricks.</p><h2 id="use-a-queue">Use a Queue</h2><p><code>Queue</code> and <code>SimpleQueue</code> types in module <code>multiprocessing</code> <sup id="fnref:2"><a href="#fn:2">2</a></sup> implement multi-producer, multi-consumer FIFO queues under the multi-processing scenario. We may create and share a queue among parent and worker processes, send individual values from parent processes and read them from workers. Since the sending and receiving operations are synchronized, we won’t run into any race conditions.</p><div class="gk-code hljs" data-gk-id="BLOCK2"><div class="gk-code-display"><pre><span class="line"><span class="hljs-keyword">def</span> <span class="hljs-title function_">worker</span>(<span class="hljs-params">q</span>):</span><br><span class="line">    <span class="hljs-built_in">print</span>(q.get())</span><br><span class="line"></span><br><span class="line">q = mp.SimpleQueue()</span><br><span class="line">p = mpp.Pool(processes=<span class="hljs-number">2</span>, initializer=worker, initargs=(q,))</span><br><span class="line"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>):</span><br><span class="line">    q.put(i)</span><br><span class="line">p.close()</span><br><span class="line"><span class="hljs-comment"># 0</span></span><br><span class="line"><span class="hljs-comment"># 1</span></span><br></pre></div></div><h2 id="use-a-value">Use a Value</h2><p>Alternatively, we may use a lighter shared object other than a queue. The <code>Value</code> type in module <code>multiprocessing</code> <sup id="fnref:3"><a href="#fn:3">3</a></sup> allows sharing simple values across multiple processes. It can also synchronize accesses to values to avoid race conditions if necessary. We can use a <code>Value</code> object to allocate an individual id for each worker process.</p><div class="gk-code hljs" data-gk-id="BLOCK3"><div class="gk-code-display"><pre><span class="line"><span class="hljs-keyword">def</span> <span class="hljs-title function_">worker</span>(<span class="hljs-params">v</span>):</span><br><span class="line">    <span class="hljs-keyword">with</span> v.get_lock():</span><br><span class="line">        val = v.value</span><br><span class="line">        v.value += <span class="hljs-number">1</span></span><br><span class="line">    <span class="hljs-built_in">print</span>(val)</span><br><span class="line"></span><br><span class="line">v = mp.Value(ctypes.c_int32, <span class="hljs-number">0</span>, lock=<span class="hljs-literal">True</span>)</span><br><span class="line">p = mpp.Pool(processes=<span class="hljs-number">2</span>, initializer=worker, initargs=(v,))</span><br><span class="line">p.close()</span><br><span class="line"><span class="hljs-comment"># 0</span></span><br><span class="line"><span class="hljs-comment"># 1</span></span><br></pre></div></div><div class="footnotes"><ol><li class="footnote" id="fn:1"><a target="_blank" rel="noopener" href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.pool.Pool">https://docs.python.org/3/library/multiprocessing.html#multiprocessing.pool.Pool</a></li><li class="footnote" id="fn:2"><a target="_blank" rel="noopener" href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.Queue">https://docs.python.org/3/library/multiprocessing.html#multiprocessing.Queue</a></li><li class="footnote" id="fn:3"><a target="_blank" rel="noopener" href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.Value">https://docs.python.org/3/library/multiprocessing.html#multiprocessing.Value</a></li></ol></div></div><div lang="zh" class="post__readmore font__ui"><a href="/initialize-pool-worker-with-individual-values/">READ MORE</a></div></article><article lang="en" class="post"><div class="post__title-block"><h1 class="post__title"><a href="/rust-python-ffi-from-scratch/">Rust - Python FFI From Scratch</a></h1><span class="post__lang-tag font__ui">en</span></div><div lang="zh" class="post__meta font__ui">2022-03-12 | <span class="post__meta-categories"><a href="/categories/Tech/">Tech</a></span></div><div data-post-id="0cce240ad0da20c647df69ab7008c714d9d42102a86c55ba1e04af5046b20c10" class="post__content font__body"><p>I was recently working on a side project that involves communication between binaries written in Rust and web interfaces written in Python. Moving a part of my project onto a language like Rust is under several considerations: <em>1)</em> the logic is all about manipulating byte arrays, where Python has deficit and system language like Rust is superior; <em>2)</em> the logic happens to be complicated, I need a static type system to ensure the correctness, and also the <code>match</code> expression of Rust is found helpful in getting things concise; <em>3)</em> I was planning to develop CLI tools with Rust, which calls this fraction of functionality, and I don’t want to rewrite the stuff in the future.</p></div><div lang="zh" class="post__readmore font__ui"><a href="/rust-python-ffi-from-scratch/">READ MORE</a></div></article></div><div lang="zh" class="page-navigator font__ui"><span class="page__button"><a href="/categories/Tech/page/2/" class="pre">PREV</a></span><span class="page__button"><a href="/categories/Tech/page/4/" class="next">NEXT</a></span></div></main><section class="aside__group"><span class="aside__btn"><div lang="zh" class="github-btn"><a href="#" rel="noopener noreferrer" target="_blank" class="gh-btn"><span class="gh-ico"></span><span class="gh-text">FOLLOW ME</span></a><a href="#" rel="noopener noreferrer" target="_blank" class="gh-count"></a></div><script>window.GH_BUTTON={username:"hsfzxjy"}</script></span><aside class="aside__left"><div class="aside__menuList"><span class="aside__menuList-item__icon"><i class="icon-home"></i></span><a href="/" class="aside__menuList-item"><span lang="zh" class="font__ui">首页 / Home</span></a><span class="aside__menuList-item__icon current"><i class="icon-embed2"></i></span><a href="/categories/Tech/" class="aside__menuList-item current"><span lang="zh" class="font__ui">科技 / Tech</span></a><span class="aside__menuList-item__icon"><i class="icon-android"></i></span><a href="/categories/Soliloquy/" class="aside__menuList-item"><span lang="zh" class="font__ui">呓语 / Soliloquy</span></a><span class="aside__menuList-item__icon"><i class="icon-leaf"></i></span><a href="/categories/Life/" class="aside__menuList-item"><span lang="zh" class="font__ui">生活 / Life</span></a><span class="aside__menuList-item__icon"><i class="icon-bookmarks"></i></span><a href="/categories/Memo/" class="aside__menuList-item"><span lang="zh" class="font__ui">速记 / Memo</span></a><span class="aside__menuList-item__icon"><i class="icon-books"></i></span><a href="/categories/Series/" class="aside__menuList-item"><span lang="zh" class="font__ui">连载 / Series</span></a><span class="aside__menuList-item__icon"><i class="icon-sigma"></i></span><a href="/works/" class="aside__menuList-item"><span lang="zh" class="font__ui">项目 / Projects</span></a><span class="aside__menuList-item__icon"><i class="icon-earth"></i></span><a href="/links/" class="aside__menuList-item"><span lang="zh" class="font__ui">友链 / Links</span></a><span class="aside__menuList-item__icon"><i class="icon-wink"></i></span><a href="/about/" class="aside__menuList-item"><span lang="zh" class="font__ui">关于 / About</span></a><span class="aside__menuList-item__icon"><i class="icon-history"></i></span><a href="/aggr/" class="aside__menuList-item"><span lang="zh" class="font__ui">索引 / Index</span></a><span class="aside__menuList-item__icon"><i class="icon-rss2"></i></span><a href="/rss.xml" class="aside__menuList-item"><span lang="zh" class="font__ui">订阅 / RSS</span></a></div></aside><aside class="aside__right"></aside></section><div id="footer" style="text-align:center" lang="zh" class="font__ui">© <a href="/" rel="nofollow">hsfzxjy 的博客.</a>&nbsp;Powered by&nbsp;<a rel="nofollow" target="_blank" href="https://hexo.io">Hexo.</a>&nbsp;<a rel="nofollow" target="_blank" href="https://github.com/hsfzxjy/byak-hexo">Theme</a>&nbsp;by&nbsp;<a rel="nofollow" target="_blank" href="https://github.com/hsfzxjy">hsfzxjy</a>.<div style="margin-top:10px"><a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44011202001249" style="display:inline-block;text-decoration:none;height:20px;line-height:20px"><img src="/img/beian.png" style="float:left" loading="lazy"><span style="float:left;height:20px;line-height:20px;margin:0 0 0 5px;color:#939393">粤公网安备44011202001249号</span></a><a target="_blank" style="display:inline-block;text-decoration:none;height:20px;line-height:20px" href="http://beian.miit.gov.cn/"><span style="float:left;height:20px;line-height:20px;margin:0 0 0 5px;color:#939393">粤ICP备2020075702号-1</span></a></div></div></body><script src="/dist/js/main.js" async defer></script></html>