<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=5" name="viewport"><meta content="yes" name="mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><title>代码的仪式</title><meta itemprop="title" content="代码的仪式 - hsfzxjy 的博客"><meta itemprop="og:title" content="代码的仪式 - hsfzxjy 的博客"><meta itemprop="image" content="https://i.hsfzxjy.site/avatar-for-hsfzxjy.jpg"><meta itemprop="og:image" content="https://i.hsfzxjy.site/avatar-for-hsfzxjy.jpg"><meta itemprop="description" content="我们常能在英文社区看到 coding ceremory 一词，或译为 代码的仪式。Stack Overflow 上..."><meta itemprop="og:type" content="website"><link rel="stylesheet" href="/dist/css/style.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="alternate" type="application/rss+xml" href="/rss.xml"></head><body><nav class="nav"><span class="nav__toggler"><span class="nav__toggler-bar bar1"></span><span class="nav__toggler-bar bar2"></span><span class="nav__toggler-bar bar3"></span></span><span class="nav__core"><div class="nav__logo"><img src="/avatar.webp" loading="lazy"></div><a href="/" lang="zh" class="nav__brand">hsfzxjy</a></span><span class="nav__togglerClose"><span class="nav__togglerClose-circle"></span><span class="nav__togglerClose-bar bar1"></span><span class="nav__togglerClose-bar bar2"></span></span><div class="nav__pathIndicator"><a href="/categories/Tech/">Tech</a></div></nav><main class="mainContainer"><div lang="zh" class="post post-page"><h1 lang="zh" class="post__title">代码的仪式</h1><div class="post__meta font__ui">2023-09-07 | <span class="post__meta-categories"><a href="/categories/Tech/">Tech</a><a href="/categories/Soliloquy/"> Soliloquy</a></span></div><div class="post__content font__body"><p>我们常能在英文社区看到 coding ceremory 一词，或译为 代码的仪式。Stack Overflow 上有个问题 <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/68092498/what-does-low-ceremony-mean">What does “low ceremony” mean?</a>，作者曾如此提问：</p><blockquote><p>In the Trac Main Features page https://trac.edgewall.org/wiki/TracFeatures, Trac is said to emphasize “ease of use and low ceremony”. Can someone please explain what “ceremony” means in the context of software usage?</p></blockquote><p class="par">low ceremony 与 ease of use 作并列短语，可见在程序开发的语境下，代码的仪式不是一个褒义词——过多的仪式并没有好处。用户 Rowan Freeman 则作此回答：</p><blockquote><p>Low ceremony means a small amount of code to achieve something. It means you don’t need to set up a lot of things in order to get going.</p></blockquote><p class="par">如其所述，代码的仪式是<strong>完成一个功能所需要的额外准备</strong>。仪式越少，准备工作越简洁，完成起来也越容易。</p><p>代码仪式被称为仪式，正如古代祭祀的舞蹈，传统庆典的繁文缛节，其对完成目标贡献甚微，却又是不可或缺的步骤。复杂的仪式冗长而乏味，我们偏偏还得忍受其枯燥，如履薄冰，完成得分毫不差——这也解释了为什么大多数人都不喜欢代码仪式。</p><h1 id="不同的代码仪式">不同的代码仪式</h1><p>依照呈现的形式，代码的仪式可以分为 编写仪式 和 运行仪式 两类。</p><h2 id="编写仪式">编写仪式</h2><p><strong>编写仪式</strong>指完成功能我们所需编写的额外代码。其中最基本的一类源自编程语言对程序完整性的要求。每种编程语言会要求用户以特定的方式编写代码，如此方能产生可运行的程序，如 C/C++ 需要定义 <code>main()</code> 函数，旧式 Java 需要声明带有 <code>public static void main()</code> 方法的类等等：</p><div class="gk-unified-code tab" data-gk-style="tab"><div class="gk-code hljs" data-gk-id="py-hello-world" data-gk-title="Python"><div class="gk-code-display"><pre><span class="line"><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Hello world&quot;</span>)</span><br></pre></div></div><div class="gk-code hljs" data-gk-id="c-hello-world" data-gk-title="C"><div class="gk-code-display"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {</span><br><span class="line">    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Hello world\n&quot;</span>);</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</span><br><span class="line">}</span><br></pre></div></div><div class="gk-code hljs" data-gk-id="java-hello-world" data-gk-title="Java 1.8"><div class="gk-code-display"><pre><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloWorld</span> {</span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {</span><br><span class="line">        System.out.println(<span class="hljs-string">&quot;Hello, World&quot;</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></div></div><div class="gk-code hljs" data-gk-id="haskell-hello-world" data-gk-title="Haskell"><div class="gk-code-display"><pre><span class="line"><span class="hljs-title">main</span> :: <span class="hljs-type">IO</span> ()</span><br><span class="line"><span class="hljs-title">main</span> = putStrLn <span class="hljs-string">&quot;Hello, World!&quot;</span></span><br></pre></div></div><div class="gk-code hljs" data-gk-id="nasm-hello-world" data-gk-title="NASM (x86, Unix)"><div class="gk-code-display"><pre><span class="line"><span class="hljs-meta">SECTION</span> .DATA</span><br><span class="line"><span class="hljs-symbol">    hello:</span>     <span class="hljs-built_in">db</span> <span class="hljs-string">&#x27;Hello world!&#x27;</span>,<span class="hljs-number">10</span></span><br><span class="line"><span class="hljs-symbol">    helloLen:</span>  <span class="hljs-built_in">equ</span> $-hello</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">; Code goes in the text section</span></span><br><span class="line"><span class="hljs-meta">SECTION</span> .TEXT</span><br><span class="line">    <span class="hljs-meta">GLOBAL</span> _start</span><br><span class="line"><span class="hljs-symbol"></span></span><br><span class="line"><span class="hljs-symbol">_start:</span></span><br><span class="line">    <span class="hljs-keyword">mov</span> <span class="hljs-built_in">eax</span>,<span class="hljs-number">4</span>            <span class="hljs-comment">; &#x27;write&#x27; system call = 4</span></span><br><span class="line">    <span class="hljs-keyword">mov</span> <span class="hljs-built_in">ebx</span>,<span class="hljs-number">1</span>            <span class="hljs-comment">; file descriptor 1 = STDOUT</span></span><br><span class="line">    <span class="hljs-keyword">mov</span> <span class="hljs-built_in">ecx</span>,hello        <span class="hljs-comment">; string to write</span></span><br><span class="line">    <span class="hljs-keyword">mov</span> <span class="hljs-built_in">edx</span>,helloLen     <span class="hljs-comment">; length of string to write</span></span><br><span class="line">    <span class="hljs-keyword">int</span> <span class="hljs-number">80h</span>              <span class="hljs-comment">; call the kernel</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">; Terminate program</span></span><br><span class="line">    <span class="hljs-keyword">mov</span> <span class="hljs-built_in">eax</span>,<span class="hljs-number">1</span>            <span class="hljs-comment">; &#x27;exit&#x27; system call</span></span><br><span class="line">    <span class="hljs-keyword">mov</span> <span class="hljs-built_in">ebx</span>,<span class="hljs-number">0</span>            <span class="hljs-comment">; exit with error code 0</span></span><br><span class="line">    <span class="hljs-keyword">int</span> <span class="hljs-number">80h</span>              <span class="hljs-comment">; call the kernel</span></span><br></pre></div></div></div><p class="par">可见不同编程语言对“程序完整性”的要求有繁有简，短者如 Python 基本没有要求，长者如汇编语言（NASM）需要手动标注代码段与数据段。但这类仪式基本是一次性的，只需在项目伊始完成，较于漫长的开发工作简直不值一提。</p><p>编写仪式也可能源于软件框架的规范要求。软件框架简化了大型程序开发的流程，针对特定领域需求构建好了程序的蓝图，事无巨细皆有覆盖。开发者借助框架开发，就好比对照蓝图搭积木，只需编写上层业务相关代码即可。在简化开发的同时，软件框架通常会束缚代码的组织形式。若以复杂性为轴，我们可以绘制一幅软件框架的光谱。框架的对代码组织形式的约束依其在光谱上的位置而大相径庭。</p><p>光谱的一端是轻量级框架。它们有着精简的内核与宽松的规范约束。大多数轻量级框架并不强求规范的目录结构，开发者只需添加少量仪式以完成必要的程序初始化。以知名 Web 框架 <a target="_blank" rel="noopener" href="https://flask.palletsprojects.com/en/2.3.x/">Flask</a> 为例。作为轻量级框架的代表，Flask 只负责做好与网络协议相关的工作，给予开发者十足的自由决定更上层逻辑的表现。借助 Flask，仅需寥寥数行代码即可构建一个最简单的 Web 程序：</p><div class="gk-code hljs" data-gk-id="BLOCK1" data-gk-title="app.py"><div class="gk-code-display"><pre><span class="line"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="hljs-keyword">def</span> <span class="hljs-title function_">hello_world</span>():</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&lt;p&gt;Hello, World!&lt;/p&gt;&quot;</span></span><br></pre></div></div><p class="par">某种意义上，这类框架可以被看作领域特定语言 <sup id="fnref:1"><a href="#fn:1">1</a></sup>，如 Flask 像是基于 Python 为 Web 开发设计的一门“语言”。以语言作类比使我们能套用前文对编程语言仪式的分析，将此类框架的仪式看作其寄主语言仪式的延伸。上面所示的代码中，<code>from flask import Flask</code> 与 <code>app = Flask(__name__)</code> 等套路化的代码，即是源自虚构的“Flask 语言”对程序完整性的要求。</p><p>光谱的另一端是重量级框架。相较于轻量级框架，重量级框架会向上层业务延伸自己的责任边界。它们的设计者通常更精通领域的业务，了解常见问题，通晓最佳实践，并尝试将这些经验融入框架中以服务开发者。</p><p>但事实上业务需求是多变的，设计者需要让框架足够灵活、足够可定制，方能满足现实中开发者的需求。灵活可定制，随之而来的代价便是框架日趋复杂。设计者或是抬高框架的抽象程度，应用设计模式使各种模块易于组合拆解；或是提供眼花缭乱的可配置项，迎合每一个潜在的需求点。前者使样板代码（boilerplate code）膨胀，后者使最佳实践难写——这些都是重量级框架仪式的体现。</p><p>我们还是以 Python Web 框架举例，但这次是著名的 <a target="_blank" rel="noopener" href="https://www.djangoproject.com/">Django</a>。和 Flask 相比，一个典型的 Django 项目需包含多个文件，并以特定的结构组织在一起。其目录结构和部分文件内容如下：</p><div class="gk-unified-code tab" data-gk-style="tab"><div class="gk-code hljs" data-gk-id="django-dir" data-gk-title="mysite/"><div class="gk-code-display"><pre><span class="gk-section gk-zip zipped" data-gk-sid="django-dir.SEC1" data-gk-type="zip"><span class="line">├── manage.py</span><br><span class="line">├── mysite</span><br><span class="line">│   ├── asgi.py</span><br><span class="line">│   ├── __init__.py</span><br><span class="line">│   ├── settings.py</span><br><span class="line">│   ├── urls.py</span><br><span class="line">│   └── wsgi.py</span><br><span class="line">└── polls</span><br><span class="line">    ├── admin.py</span><br><span class="line">    ├── apps.py</span><br><span class="line">    ├── __init__.py</span><br><span class="line">    ├── migrations</span><br><span class="line">    │   └── __init__.py</span><br><span class="line">    ├── models.py</span><br><span class="line">    ├── tests.py</span><br><span class="line">    └── views.py</span><br></span><span class="line">3 directories, 13 files</span><br></pre></div></div><div class="gk-code hljs" data-gk-id="BLOCK2" data-gk-title="settings.py"><div class="gk-code-display"><pre><span class="line"><span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> Path</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Build paths inside the project like this: BASE_DIR / &#x27;subdir&#x27;.</span></span><br><span class="line">BASE_DIR = Path(__file__).resolve().parent.parent</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Quick-start development settings - unsuitable for production</span></span><br><span class="line"><span class="hljs-comment"># See https://docs.djangoproject.com/en/4.2/howto/deployment/checklist/</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># SECURITY WARNING: keep the secret key used in production secret!</span></span><br><span class="line">SECRET_KEY = <span class="hljs-string">&quot;django-insecure-kqi@xv-ay@y!c2es$5m)b&amp;uulbt-l8g28kw-)o2$&amp;w#@2uvx#&amp;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># SECURITY WARNING: don&#x27;t run with debug turned on in production!</span></span><br><span class="line">DEBUG = <span class="hljs-literal">True</span></span><br><span class="line"></span><br><span class="line">ALLOWED_HOSTS = []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Application definition</span></span><br><span class="line"></span><br><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="hljs-string">&quot;django.contrib.admin&quot;</span>,</span><br><span class="line">    <span class="hljs-string">&quot;django.contrib.auth&quot;</span>,</span><br><span class="line">    <span class="hljs-string">&quot;django.contrib.contenttypes&quot;</span>,</span><br><span class="line">    <span class="hljs-string">&quot;django.contrib.sessions&quot;</span>,</span><br><span class="line">    <span class="hljs-string">&quot;django.contrib.messages&quot;</span>,</span><br><span class="line">    <span class="hljs-string">&quot;django.contrib.staticfiles&quot;</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">MIDDLEWARE = [</span><br><span class="line">    <span class="hljs-string">&quot;django.middleware.security.SecurityMiddleware&quot;</span>,</span><br><span class="line">    <span class="hljs-string">&quot;django.contrib.sessions.middleware.SessionMiddleware&quot;</span>,</span><br><span class="line">    <span class="hljs-string">&quot;django.middleware.common.CommonMiddleware&quot;</span>,</span><br><span class="line">    <span class="hljs-string">&quot;django.middleware.csrf.CsrfViewMiddleware&quot;</span>,</span><br><span class="line">    <span class="hljs-string">&quot;django.contrib.auth.middleware.AuthenticationMiddleware&quot;</span>,</span><br><span class="line">    <span class="hljs-string">&quot;django.contrib.messages.middleware.MessageMiddleware&quot;</span>,</span><br><span class="line">    <span class="hljs-string">&quot;django.middleware.clickjacking.XFrameOptionsMiddleware&quot;</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">ROOT_URLCONF = <span class="hljs-string">&quot;mysite.urls&quot;</span></span><br><span class="line"></span><br><span class="line">TEMPLATES = [</span><br><span class="line">    {</span><br><span class="line">        <span class="hljs-string">&quot;BACKEND&quot;</span>: <span class="hljs-string">&quot;django.template.backends.django.DjangoTemplates&quot;</span>,</span><br><span class="line">        <span class="hljs-string">&quot;DIRS&quot;</span>: [],</span><br><span class="line">        <span class="hljs-string">&quot;APP_DIRS&quot;</span>: <span class="hljs-literal">True</span>,</span><br><span class="line">        <span class="hljs-string">&quot;OPTIONS&quot;</span>: {</span><br><span class="line">            <span class="hljs-string">&quot;context_processors&quot;</span>: [</span><br><span class="line">                <span class="hljs-string">&quot;django.template.context_processors.debug&quot;</span>,</span><br><span class="line">                <span class="hljs-string">&quot;django.template.context_processors.request&quot;</span>,</span><br><span class="line">                <span class="hljs-string">&quot;django.contrib.auth.context_processors.auth&quot;</span>,</span><br><span class="line">                <span class="hljs-string">&quot;django.contrib.messages.context_processors.messages&quot;</span>,</span><br><span class="line">            ],</span><br><span class="line">        },</span><br><span class="line">    },</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">WSGI_APPLICATION = <span class="hljs-string">&quot;mysite.wsgi.application&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Database</span></span><br><span class="line"><span class="hljs-comment"># https://docs.djangoproject.com/en/4.2/ref/settings/#databases</span></span><br><span class="line"></span><br><span class="line">DATABASES = {</span><br><span class="line">    <span class="hljs-string">&quot;default&quot;</span>: {</span><br><span class="line">        <span class="hljs-string">&quot;ENGINE&quot;</span>: <span class="hljs-string">&quot;django.db.backends.sqlite3&quot;</span>,</span><br><span class="line">        <span class="hljs-string">&quot;NAME&quot;</span>: BASE_DIR / <span class="hljs-string">&quot;db.sqlite3&quot;</span>,</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Password validation</span></span><br><span class="line"><span class="hljs-comment"># https://docs.djangoproject.com/en/4.2/ref/settings/#auth-password-validators</span></span><br><span class="line"></span><br><span class="line">AUTH_PASSWORD_VALIDATORS = [</span><br><span class="line">    {</span><br><span class="line">        <span class="hljs-string">&quot;NAME&quot;</span>: <span class="hljs-string">&quot;django.contrib.auth.password_validation.UserAttributeSimilarityValidator&quot;</span>,</span><br><span class="line">    },</span><br><span class="line">    {</span><br><span class="line">        <span class="hljs-string">&quot;NAME&quot;</span>: <span class="hljs-string">&quot;django.contrib.auth.password_validation.MinimumLengthValidator&quot;</span>,</span><br><span class="line">    },</span><br><span class="line">    {</span><br><span class="line">        <span class="hljs-string">&quot;NAME&quot;</span>: <span class="hljs-string">&quot;django.contrib.auth.password_validation.CommonPasswordValidator&quot;</span>,</span><br><span class="line">    },</span><br><span class="line">    {</span><br><span class="line">        <span class="hljs-string">&quot;NAME&quot;</span>: <span class="hljs-string">&quot;django.contrib.auth.password_validation.NumericPasswordValidator&quot;</span>,</span><br><span class="line">    },</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Internationalization</span></span><br><span class="line"><span class="hljs-comment"># https://docs.djangoproject.com/en/4.2/topics/i18n/</span></span><br><span class="line"></span><br><span class="line">LANGUAGE_CODE = <span class="hljs-string">&quot;en-us&quot;</span></span><br><span class="line"></span><br><span class="line">TIME_ZONE = <span class="hljs-string">&quot;UTC&quot;</span></span><br><span class="line"></span><br><span class="line">USE_I18N = <span class="hljs-literal">True</span></span><br><span class="line"></span><br><span class="line">USE_TZ = <span class="hljs-literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Static files (CSS, JavaScript, Images)</span></span><br><span class="line"><span class="hljs-comment"># https://docs.djangoproject.com/en/4.2/howto/static-files/</span></span><br><span class="line"></span><br><span class="line">STATIC_URL = <span class="hljs-string">&quot;static/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Default primary key field type</span></span><br><span class="line"><span class="hljs-comment"># https://docs.djangoproject.com/en/4.2/ref/settings/#default-auto-field</span></span><br><span class="line"></span><br><span class="line">DEFAULT_AUTO_FIELD = <span class="hljs-string">&quot;django.db.models.BigAutoField&quot;</span></span><br></pre></div></div><div class="gk-code hljs" data-gk-id="django-urls" data-gk-title="urls.py"><div class="gk-code-display"><pre><span class="line"><span class="hljs-keyword">from</span> django.contrib <span class="hljs-keyword">import</span> admin</span><br><span class="line"><span class="hljs-keyword">from</span> django.urls <span class="hljs-keyword">import</span> path</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="hljs-string">&quot;admin/&quot;</span>, admin.site.urls),</span><br><span class="line">]</span><br></pre></div></div></div><p class="par">Django 提倡以模块切分业务逻辑，每个模块置于单独的目录，称为一个 app。本例中目录 <code>polls/</code> 便是一个 app，其下的各文件分别定义了所属 app 的数据模型、视图和路由等。Django 奉行所谓的 <a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/4.2/faq/general/#django-appears-to-be-a-mvc-framework-but-you-call-the-controller-the-view-and-the-view-the-template-how-come-you-don-t-use-the-standard-names">MTV 模式</a>，即将数据的逻辑和展示分开，使程序更加易于维护。MTV 模式便是 Django 为可维护性引入的额外抽象，其代价是项目结构的复杂化与业务无关代码的增多。而为了更高的灵活性，Django 在 settings.py 中提供了多个配置项。用户可通过调整配置项的值，以满足业务的特定需求。此二者相合便是 Django 开发的编写仪式。</p><h2 id="运行仪式">运行仪式</h2><p><strong>运行仪式</strong>是将所写代码执行起来所要付出的额外努力。编写仪式是代码跃于纸上的成本，运行仪式则是代码脱胎成型的代价。 最常见的运行仪式莫过于“程序编译”，这也是人们通常评判运行仪式的焦点。</p><p>程序编译即将代码经由某种手段转移为目标代码。编译型语言，如 C/C++、Rust、Go 或 Java 等，其代码须经此工序方能运行。目标代码通常是机器码，但也不尽然，如 Java 是编译为 JVM 的字节码，牺牲一定的效率以换取跨平台能力。</p><p>许多人讨厌编译，害怕编译。这一方面是因为编译在代码编写和程序运行中间强插了间隙，加剧调试的延时与焦虑。但最主要的还是编译工序的繁杂与报错的晦涩。C++ 便是个典型例子。其编译的仪式源自语言的设计缺陷——模块概念的缺乏使编译工序冗繁，语法的异常复杂使编译报错晦涩难懂。编译的复杂性还可能源自业务本身的复杂性。如在 Android 开发中，你几乎不可能脱离 Android SDK 完成程序的编译——这是由交叉编译的复杂性所决定的。</p><p>程序编译曾是编译型语言的特需，但近年来，解释型语言中也出现了这种需求，其中以 Web 前端开发尤甚。Web 前端程序的运行环境有特殊性。浏览器以 HTML、CSS 以及 Javascript 三种语言的源代码作为最直接、最底层的输入，极大简化了程序的编写。但另一方面，这三种语言结构松散、抽象能力有限，同时在不同平台上标准不一，这迫使人们引入框架和工程化手段以提高大型程序的开发效率和可维护性。人们用表现力更强的“方言”（如 Typescript）编写代码，用更合理的文件结构和抽象程度更高的框架（React、Angular）组织代码，再通过工具编译成为浏览器所能执行的三种语言。这种模式在初期而饱受诟病，后因工具链的不断完善而逐渐被人们接受，直至今日成为了大多数项目的标准配置。</p><p>然而，就算是摆脱了编译梦魇的其他解释型语言，在开发过程中也会遇到其他运行仪式。Python 开发者常被依赖安装问题所困。Python 程序免除了程序编译的步骤，却只是把编译期的问题延至运行期。当程序运行时，你需要保证其所依赖的每个模块都被正确安装在正确的位置，并且有着正确的版本号。达成这点并不容易，有时它要求操作系统内要有某个老旧的库，但这个库又被其他程序所依赖，不得轻易修改（早期深度学习开发者应该深有体会）。此种依赖模式还使程序变得难以分发——因为分发对象的机器上也要有对应的依赖。依赖问题催生了 virtualenv、Anaconda 乃至 Docker 等策略的应用，但这愈发加重了 Python 运行仪式的繁杂。</p><h1 id="讨论与分析">讨论与分析</h1><p>许多代码仪式其实是迫不得已的产物。这一方面源于业务本身，另一方面源于人。</p><p>业务复杂性是代码仪式的最直接成因，决定了其复杂性的下限。如前面所述的 Android 开发必须有 Android SDK 支持，是因为生成一个可执行的 apk 文件就是有这么复杂。另一个例子是 Python 时代前的深度学习开发，人们被各种库的编译与运行时的问题折腾得不轻，是因为 CUDA 编程本身就有这么复杂。</p><p>但另一方面，我们还要考虑人的因素。大型程序编写是人分工管理的艺术。人与人的能力不同，效率不同，让项目的有效开发与可维护性成了头疼的问题。此时，框架的设计者或是项目的领导者需提高基础代码的抽象层次，以实现对项目逻辑的拆解，更高效地进行团队协作。这也是为什么大型项目或框架会需要许多样板代码或是胶水代码。重量级框架的意义是积极的，它着眼处理的是大型程序的问题。如果你觉得它们很繁琐，可能是你和它们的目标人群并不完全契合，你需要找寻更轻量级的解决方案。</p><p>让人有效协作的另一个手段是压制个性，简单来说便是让所有人都尽量写出质量差不多的代码。这可以从两方面入手。一是使用工具制定代码规范，强迫每处代码遵从一致的风格。Web 前端常用的 ESLint、Python 常用的 pylint 和 autopep8 便是为此服务的。这类工具增加了代码的仪式，但保持了代码的可维护性。另一个方案则是采用尽量简单的编程语言。Java 之所以被企业广泛采用，一部分原因是其语法足够简单，开发者无法写出个性差异巨大的代码，从而能维持项目的一致性。然而，“语法简单”与“抽象能力不足”是一体两面的。语法简单的 Java 在许多时候会显得捉襟见肘，以致需要各种设计模式补偿抽象能力的缺陷，这进而又使代码仪式复杂化了。</p><p>在考察代码仪式时，解决方案的灵活性也是个有趣的因素。前文说有着诸多配置项的重型框架会增加代码仪式，那内核紧致的轻型框架又如何呢？轻型框架收缩了责任边界，让社区去构建多种多样的插件以满足上层业务的需求，是否兼具低代码仪式与高灵活性呢？</p><p>历史上曾有多种微内核高扩展性的解决方案。Flask 是 Python 后端开发方案中的此类代表。Flask 很简洁，同时有着海量社区插件。但当人们想利用插件构建稍微复杂的程序时，却总会觉得如鲠在喉。一方面是因为插件良莠不齐，总是要斟酌许久才能选中一个特定功能的插件，而且这个插件还不能让人百分百满意。另一方面是各插件之间通常保持着绝对的独立，想在插件间做交互往往要写更多的胶水代码。人们逐渐发现，想利用在野的插件组合出任意需求是很难的，很多时候不如自己从头重写，或是使用一站式的重型框架。与此类似的还有前端的 Webpack——在其鼎盛时期，你在网上可以找到 1000 种编译 ES6 的方案，但每一种都有些小瑕疵。</p><p>人们渐渐发现选择众多并不总是一件好事。选择带来争端与标准的割裂，于高效开发是无益的。人们需要一种独断的（opinionated）、大家长式的解决方案，减少选择提高效率。这种解决方案必须瞄准领域的某个最佳实践，有且只能有一个，同时隐藏多数可选项，只提供少数或完全不提供配置项。这种模式看似违背自由竞争的意志，却能切实地减少不必要的代码仪式，提高效率。用 Python 写 Restful API 时，人们更倾向于使用 FastAPI 而不是 Flask；构建前端时，人们发现 Vite 比 Webpack 更省心。这种思潮也深刻影响了近几年开发工具的设计思路。新兴语言如 Go、Rust，其官方都会提供足够好用的包管理器、构建工具以及格式化器等，从源头掐断各种争纷，让用户专注于程序的设计。</p><h1 id="尾声">尾声</h1><p>事实上，代码仪式是一个宽泛非正式的概念。人们总是在抱怨某某代码仪式的复杂，但人们没有系统地讨论过。本文无法面面俱到地讨论各种仪式的表现、成因和应对，只是结合现实中的例子粗略地讲解了一下。愿读者能有所收获。</p><div class="footnotes"><ol><li class="footnote" id="fn:1">Domain-Specific Language (DSL)</li></ol></div><br><blockquote><p class="cc">作者：hsfzxjy<br>链接：<span class="cc-link"></span><br>许可：<a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/">CC BY-NC-ND 4.0</a>.<br>著作权归作者所有。本文<b>不允许</b>被用作商业用途，非商业转载请注明出处。</p></blockquote><script>!function(){var n=document.querySelector("span.cc-link");n&&(n.innerHTML='<a href="'+location.href+'">'+location.href+"</a>")}()</script></div><div class="post__tags"><a href="/tags/Random-Thoughts/">Random Thoughts</a><a href="/tags/Methodology/">Methodology</a><a href="/tags/Programming/">Programming</a></div><div class="post-nav"><a href="/display-rat-losslessly-smartly-go/" class="pre">«Display *big.Rat Losslessly and Smartly in Golang</a><a href="/building-electron-memo/" class="next">Building Electron From Scratch»</a></div><div id="disqus_thread"><div id="no-comment"><h2>OOPS!</h2><span>A comment box should be right here...</span><span>But it was gone due to network issues :-(</span><span>If you want to leave comments, make sure you have access to&nbsp;<a target="_blank" rel="noopener" href="https://disqus.com">disqus.com</a>.</span></div><script>var disqus_shortname="hsfzxjy",disqus_identifier="coding-ceremory/",disqus_title="代码的仪式",disqus_url="https://i.hsfzxjy.site/coding-ceremory/";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.defer=!0,e.src="https://"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("body")[0]||document.getElementsByTagName("head")[0]).appendChild(e),e.onerror=function(){document.getElementById("no-comment").classList.add("show")}}()</script><script id="dsq-count-scr" src="//hsfzxjy.disqus.com/count.js" async defer></script></div></div></main><section class="aside__group"><span class="aside__btn"><div lang="zh" class="github-btn"><a href="#" rel="noopener noreferrer" target="_blank" class="gh-btn"><span class="gh-ico"></span><span class="gh-text">FOLLOW ME</span></a><a href="#" rel="noopener noreferrer" target="_blank" class="gh-count"></a></div><script>window.GH_BUTTON={username:"hsfzxjy"}</script></span><aside class="aside__left"><div class="aside__menuList"><span class="aside__menuList-item__icon"><i class="icon-home"></i></span><a href="/" class="aside__menuList-item"><span lang="zh" class="font__ui">首页 / Home</span></a><span class="aside__menuList-item__icon current"><i class="icon-embed2"></i></span><a href="/categories/Tech/" class="aside__menuList-item current"><span lang="zh" class="font__ui">科技 / Tech</span></a><span class="aside__menuList-item__icon"><i class="icon-android"></i></span><a href="/categories/Soliloquy/" class="aside__menuList-item"><span lang="zh" class="font__ui">呓语 / Soliloquy</span></a><span class="aside__menuList-item__icon"><i class="icon-leaf"></i></span><a href="/categories/Life/" class="aside__menuList-item"><span lang="zh" class="font__ui">生活 / Life</span></a><span class="aside__menuList-item__icon"><i class="icon-bookmarks"></i></span><a href="/categories/Memo/" class="aside__menuList-item"><span lang="zh" class="font__ui">速记 / Memo</span></a><span class="aside__menuList-item__icon"><i class="icon-books"></i></span><a href="/categories/Series/" class="aside__menuList-item"><span lang="zh" class="font__ui">连载 / Series</span></a><span class="aside__menuList-item__icon"><i class="icon-sigma"></i></span><a href="/works/" class="aside__menuList-item"><span lang="zh" class="font__ui">项目 / Projects</span></a><span class="aside__menuList-item__icon"><i class="icon-earth"></i></span><a href="/links/" class="aside__menuList-item"><span lang="zh" class="font__ui">友链 / Links</span></a><span class="aside__menuList-item__icon"><i class="icon-wink"></i></span><a href="/about/" class="aside__menuList-item"><span lang="zh" class="font__ui">关于 / About</span></a><span class="aside__menuList-item__icon"><i class="icon-history"></i></span><a href="/aggr/" class="aside__menuList-item"><span lang="zh" class="font__ui">索引 / Index</span></a><span class="aside__menuList-item__icon"><i class="icon-rss2"></i></span><a href="/rss.xml" class="aside__menuList-item"><span lang="zh" class="font__ui">订阅 / RSS</span></a></div></aside><aside class="aside__right"><div id="toc" lang="zh" class="font__body"><div class="toc-toggler"></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%8D%E5%90%8C%E7%9A%84%E4%BB%A3%E7%A0%81%E4%BB%AA%E5%BC%8F"><span class="toc-number">1.</span> <span class="toc-text">不同的代码仪式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E4%BB%AA%E5%BC%8F"><span class="toc-number">1.1.</span> <span class="toc-text">编写仪式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E4%BB%AA%E5%BC%8F"><span class="toc-number">1.2.</span> <span class="toc-text">运行仪式</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%A8%E8%AE%BA%E4%B8%8E%E5%88%86%E6%9E%90"><span class="toc-number">2.</span> <span class="toc-text">讨论与分析</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B0%BE%E5%A3%B0"><span class="toc-number">3.</span> <span class="toc-text">尾声</span></a></li></ol></div></div></aside></section><div id="footer" style="text-align:center" lang="zh" class="font__ui">© <a href="/" rel="nofollow">hsfzxjy 的博客.</a>&nbsp;Powered by&nbsp;<a rel="nofollow" target="_blank" href="https://hexo.io">Hexo.</a>&nbsp;<a rel="nofollow" target="_blank" href="https://github.com/hsfzxjy/byak-hexo">Theme</a>&nbsp;by&nbsp;<a rel="nofollow" target="_blank" href="https://github.com/hsfzxjy">hsfzxjy</a>.<div style="margin-top:10px"><a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44011202001249" style="display:inline-block;text-decoration:none;height:20px;line-height:20px"><img src="/img/beian.png" style="float:left" loading="lazy"><span style="float:left;height:20px;line-height:20px;margin:0 0 0 5px;color:#939393">粤公网安备44011202001249号</span></a><a target="_blank" style="display:inline-block;text-decoration:none;height:20px;line-height:20px" href="http://beian.miit.gov.cn/"><span style="float:left;height:20px;line-height:20px;margin:0 0 0 5px;color:#939393">粤ICP备2020075702号-1</span></a></div></div></body><script src="/dist/js/main.js" async defer></script></html>