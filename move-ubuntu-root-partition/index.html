<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=5" name="viewport"><meta content="yes" name="mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><title>Move the Root Partition of Ubuntu</title><meta itemprop="title" content="Move the Root Partition of Ubuntu - hsfzxjy 的博客"><meta itemprop="og:title" content="Move the Root Partition of Ubuntu - hsfzxjy 的博客"><meta itemprop="image" content="https://i.hsfzxjy.site/avatar-for-hsfzxjy.jpg"><meta itemprop="og:image" content="https://i.hsfzxjy.site/avatar-for-hsfzxjy.jpg"><meta itemprop="description" content="A few days ago, I decided to shrink the footprint of the ..."><meta itemprop="og:type" content="website"><link rel="stylesheet" href="/dist/css/style.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="alternate" type="application/rss+xml" href="/rss.xml"></head><body><nav class="nav"><span class="nav__toggler"><span class="nav__toggler-bar bar1"></span><span class="nav__toggler-bar bar2"></span><span class="nav__toggler-bar bar3"></span></span><span class="nav__core"><div class="nav__logo"><img src="/avatar.webp" loading="lazy"></div><a href="/" lang="zh" class="nav__brand">hsfzxjy</a></span><span class="nav__togglerClose"><span class="nav__togglerClose-circle"></span><span class="nav__togglerClose-bar bar1"></span><span class="nav__togglerClose-bar bar2"></span></span><div class="nav__pathIndicator"><a href="/categories/Tech/">Tech</a></div></nav><main class="mainContainer"><div lang="en" class="post post-page"><h1 lang="en" class="post__title">Move the Root Partition of Ubuntu</h1><div class="post__meta font__ui">2022-11-13 | <span class="post__meta-categories"><a href="/categories/Tech/">Tech</a></span></div><div class="post__content font__body"><p>A few days ago, I decided to shrink the footprint of the Windows system on my laptop and reallocate the freed-up disk space to Ubuntu, which I use alongside it. Since I primarily rely on Ubuntu for programming and web browsing, I’ve rarely booted into the OEM-shipped Windows since purchasing the laptop. Windows occupies a significant portion of my SSD, and reclaiming that space allows for better use rather than letting it sit idle.</p><div class="gk-code hljs" data-gk-id="BLOCK1"><div class="gk-code-display"><pre><span class="line">#gk:immersive</span><br><span class="line">(before)</span><br><span class="line">| --- Windows C: (256 GB) --- | --- Ubuntu / (256 GB) --- |</span><br><span class="line">(after)</span><br><span class="line">| --- Windows C: (120 GB) --- | --- Ubuntu / (392 GB) --- |</span><br></pre></div></div><p>As planned in the diagram above, 136 GB space would be reclaimed from the Windows C: partition and merged into Ubuntu’s root partition. While I’ve had experience resizing disk partitions before, this operation was a bit more risky–it required shifting the starting point of the Linux root partition. Since Linux depends on specific boot information stored in the <code>/boot/efi</code> directory, failing to update this information properly during the move could render the entire system unbootable.</p><p>To avoid any catastrophic consequences, I did some research in advance and followed a detailed guide I found on <a target="_blank" rel="noopener" href="https://askubuntu.com/a/626609/706812">AskUbuntu</a>. It turns out the tweak involves two key steps. The first is resizing the partitions using <a target="_blank" rel="noopener" href="https://gparted.org/">GParted</a>, just like I’ve done before with standard data partitions. Since GParted needs full access to the disk, it must be run from a separate USB device, allowing all internal partitions to be unmounted during the operation. Fortunately, this step is quite straightforward thanks to GParted’s intuitive GUI, which lets me make the necessary adjustments with just a few clicks.</p><p>Each disk partition is assigned a unique identifier called UUID – something like <code>b424102c-a5a6-489f-b0bd-0ea0fc3be7c3</code>. This UUID can change when a partition is moved or resized, which means the system’s bootloader configuration must be updated accordingly. The next step, then, is to rebuild the GRUB configuration to reflect the new UUID of the root partition. Before running <code>grub-install</code>, however, I needed to recreate the Ubuntu system’s directory hierarchy by mounting the necessary partitions and then using <code>chroot</code> to launch an interactive shell within that environment.</p><div class="gk-code hljs" data-gk-id="BLOCK2"><div class="gk-code-display"><pre><span class="line">(gparted)$ <span class="hljs-built_in">mkdir</span> /tmp/mydir</span><br><span class="line">(gparted)$ mount /dev/nvme0n1p5 /tmp/mydir</span><br><span class="line">(gparted)$ mount --<span class="hljs-built_in">bind</span> /dev /tmp/mydir/dev</span><br><span class="line">(gparted)$ mount --<span class="hljs-built_in">bind</span> /proc /tmp/mydir/proc</span><br><span class="line">(gparted)$ mount --<span class="hljs-built_in">bind</span> /sys /tmp/mydir/sys</span><br><span class="line">(gparted)$ <span class="hljs-built_in">chroot</span> /tmp/mydir</span><br><span class="line"><span class="hljs-built_in">chroot</span>: failed to run <span class="hljs-built_in">command</span> ‘/bin/bash’: No such file or directory</span><br></pre></div></div><p>However, when I followed the guide, the <code>chroot</code> command failed with an error stating that <code>/bin/bash</code> could not be found. Upon inspecting the corresponding directory at <code>/tmp/mydir/bin</code>, I discovered that it was a broken symbolic link.</p><div class="gk-code hljs" data-gk-id="BLOCK3"><div class="gk-code-display"><pre><span class="line">(gparted)$ <span class="hljs-built_in">ls</span> /tmp/mydir/bin -al</span><br><span class="line">lrwxrwxrwx 1 root root 7 May 28  2020 /tmp/mydir/bin -&gt; usr/bin</span><br></pre></div></div><p class="par">It appears that <code>/bin</code> is a symlink to <code>usr/bin</code>, but my <code>/usr</code> directory resides on the other partition and not yet mounted. With the directory <code>/usr</code> mounted, the <code>chroot</code> command works as desired.</p><div class="gk-code hljs" data-gk-id="BLOCK4"><div class="gk-code-display"><pre><span class="line">(gparted)$ mount /dev/sda7 /tmp/mydir/usr</span><br><span class="line">(gparted)$ <span class="hljs-built_in">chroot</span> /tmp/mydir</span><br><span class="line">(ubuntu)$</span><br></pre></div></div><p class="par">The spawned interactive shell allows command to run as it were in my Ubuntu system. Type <code>grub-install /dev/nvme0n1</code> to write in the new serial number of root partition. It’s worth noting that the argument <code>/dev/nvme0n1</code> passed to <code>grub-install</code> is the name of the <em>hard disk device</em> to write instead of some partition name like <code>/dev/nvme0n1p1</code>.</p><div class="gk-code hljs" data-gk-id="BLOCK5"><div class="gk-code-display"><pre><span class="line">(ubuntu)$ grub-install /dev/nvme0n1</span><br><span class="line">Installing <span class="hljs-keyword">for</span> x86_64-efi platform.</span><br><span class="line">grub-install: error: cannot find EFI directory.</span><br></pre></div></div><p class="par">Oops, the command failed and something still going wrong. After some time of inspection, I find the culprit to be that the directory <code>/boot/efi</code> is empty, which by default should be a bind mount to partition <code>/dev/nvme0n1p1</code> but not mounted properly. This can be solved with another <code>mount</code> command</p><div class="gk-code hljs" data-gk-id="BLOCK6"><div class="gk-code-display"><pre><span class="line">(ubuntu)$ mount /dev/nvme0n1p1 /boot/efi</span><br><span class="line">(ubuntu)$ grub-install /dev/nvme0n1</span><br><span class="line">Installing <span class="hljs-keyword">for</span> x86_64-efi platform.</span><br><span class="line">Installation finished. No error reported.</span><br></pre></div></div><p class="par">By now the boot information is eventually updated. I reboot my laptop and everything works as-is.</p><p>The key takeaway from this tweaking process is that certain special directories – like <code>/usr</code> or <code>/boot/efi</code> – reside on separate partitions outside the root <code>/</code> on my laptop. When repairing GRUB or dealing with similar boot issues, it’s crucial to correctly mount all relevant partitions to reconstruct the full filesystem hierarchy. Failing to do so can lead to errors like broken symbolic links or missing binaries during chroot.</p><br><blockquote><p class="cc"><b>Author:</b> hsfzxjy.<br><b>Link:</b> <span class="cc-link"></span>.<br><b>License:</b> <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/">CC BY-NC-ND 4.0</a>.<br>All rights reserved by the author.<br>Commercial use of this post in any form is <b>NOT</b> permitted.<br>Non-commercial use of this post should be attributed with this block of text.</p></blockquote><script>!function(){var n=document.querySelector("span.cc-link");n&&(n.innerHTML='<a href="'+location.href+'">'+location.href+"</a>")}()</script></div><div class="post__tags"><a href="/tags/Ubuntu/">Ubuntu</a><a href="/tags/System-Maintainance/">System Maintainance</a></div><div class="post-nav"><a href="/gpg-and-github-interoperation/" class="pre">«Modern Cryptography, GPG and Integration with Git(hub)</a><a href="/a-new-programmer-kicks-a-roadblock/" class="next">A New Programmer Kicks a Roadblock»</a></div><div id="disqus_thread"><div id="no-comment"><h2>OOPS!</h2><span>A comment box should be right here...</span><span>But it was gone due to network issues :-(</span><span>If you want to leave comments, make sure you have access to&nbsp;<a target="_blank" rel="noopener" href="https://disqus.com">disqus.com</a>.</span></div><script>var disqus_shortname="hsfzxjy",disqus_identifier="move-ubuntu-root-partition/",disqus_title="Move the Root Partition of Ubuntu",disqus_url="https://i.hsfzxjy.site/move-ubuntu-root-partition/";!function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.defer=!0,t.src="https://"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("body")[0]||document.getElementsByTagName("head")[0]).appendChild(t),t.onerror=function(){document.getElementById("no-comment").classList.add("show")}}()</script><script id="dsq-count-scr" src="//hsfzxjy.disqus.com/count.js" async defer></script></div></div></main><section class="aside__group"><span class="aside__btn"><div lang="zh" class="github-btn"><a href="#" rel="noopener noreferrer" target="_blank" class="gh-btn"><span class="gh-ico"></span><span class="gh-text">FOLLOW ME</span></a><a href="#" rel="noopener noreferrer" target="_blank" class="gh-count"></a></div><script>window.GH_BUTTON={username:"hsfzxjy"}</script></span><aside class="aside__left"><div class="aside__menuList"><span class="aside__menuList-item__icon"><i class="icon-home"></i></span><a href="/" class="aside__menuList-item"><span lang="zh" class="font__ui">首页 / Home</span></a><span class="aside__menuList-item__icon current"><i class="icon-embed2"></i></span><a href="/categories/Tech/" class="aside__menuList-item current"><span lang="zh" class="font__ui">科技 / Tech</span></a><span class="aside__menuList-item__icon"><i class="icon-android"></i></span><a href="/categories/Soliloquy/" class="aside__menuList-item"><span lang="zh" class="font__ui">呓语 / Soliloquy</span></a><span class="aside__menuList-item__icon"><i class="icon-leaf"></i></span><a href="/categories/Life/" class="aside__menuList-item"><span lang="zh" class="font__ui">生活 / Life</span></a><span class="aside__menuList-item__icon"><i class="icon-bookmarks"></i></span><a href="/categories/Memo/" class="aside__menuList-item"><span lang="zh" class="font__ui">速记 / Memo</span></a><span class="aside__menuList-item__icon"><i class="icon-books"></i></span><a href="/categories/Series/" class="aside__menuList-item"><span lang="zh" class="font__ui">连载 / Series</span></a><span class="aside__menuList-item__icon"><i class="icon-sigma"></i></span><a href="/works/" class="aside__menuList-item"><span lang="zh" class="font__ui">项目 / Projects</span></a><span class="aside__menuList-item__icon"><i class="icon-earth"></i></span><a href="/links/" class="aside__menuList-item"><span lang="zh" class="font__ui">友链 / Links</span></a><span class="aside__menuList-item__icon"><i class="icon-wink"></i></span><a href="/about/" class="aside__menuList-item"><span lang="zh" class="font__ui">关于 / About</span></a><span class="aside__menuList-item__icon"><i class="icon-history"></i></span><a href="/aggr/" class="aside__menuList-item"><span lang="zh" class="font__ui">索引 / Index</span></a><span class="aside__menuList-item__icon"><i class="icon-rss2"></i></span><a href="/rss.xml" class="aside__menuList-item"><span lang="zh" class="font__ui">订阅 / RSS</span></a></div></aside><aside class="aside__right"></aside></section><div id="footer" style="text-align:center" lang="zh" class="font__ui">© <a href="/" rel="nofollow">hsfzxjy 的博客.</a>&nbsp;Powered by&nbsp;<a rel="nofollow" target="_blank" href="https://hexo.io">Hexo.</a>&nbsp;<a rel="nofollow" target="_blank" href="https://github.com/hsfzxjy/byak-hexo">Theme</a>&nbsp;by&nbsp;<a rel="nofollow" target="_blank" href="https://github.com/hsfzxjy">hsfzxjy</a>.<div style="margin-top:10px"><a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44011202001249" style="display:inline-block;text-decoration:none;height:20px;line-height:20px"><img src="/img/beian.png" style="float:left" loading="lazy"><span style="float:left;height:20px;line-height:20px;margin:0 0 0 5px;color:#939393">粤公网安备44011202001249号</span></a><a target="_blank" style="display:inline-block;text-decoration:none;height:20px;line-height:20px" href="http://beian.miit.gov.cn/"><span style="float:left;height:20px;line-height:20px;margin:0 0 0 5px;color:#939393">粤ICP备2020075702号-1</span></a></div></div></body><script src="/dist/js/main.js" async defer></script></html>