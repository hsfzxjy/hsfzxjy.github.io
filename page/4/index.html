<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=5" name="viewport"><meta content="yes" name="mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><title>hsfzxjy 的博客</title><meta itemprop="title" content="hsfzxjy 的博客"><meta itemprop="og:title" content="hsfzxjy 的博客"><meta itemprop="image" content="https://i.hsfzxjy.site/avatar-for-hsfzxjy.jpg"><meta itemprop="og:image" content="https://i.hsfzxjy.site/avatar-for-hsfzxjy.jpg"><meta itemprop="og:type" content="website"><link rel="stylesheet" href="/dist/css/style.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="alternate" type="application/rss+xml" href="/rss.xml"></head><body><nav class="nav"><span class="nav__toggler"><span class="nav__toggler-bar bar1"></span><span class="nav__toggler-bar bar2"></span><span class="nav__toggler-bar bar3"></span></span><span class="nav__core"><div class="nav__logo"><img src="/avatar.webp" loading="lazy"></div><a href="/" lang="zh" class="nav__brand">hsfzxjy</a></span><span class="nav__togglerClose"><span class="nav__togglerClose-circle"></span><span class="nav__togglerClose-bar bar1"></span><span class="nav__togglerClose-bar bar2"></span></span><div class="nav__pathIndicator"><a href="/">Home</a></div></nav><main class="mainContainer"><div class="post-list"><article lang="en" class="post"><div class="post__title-block"><h1 class="post__title"><a href="/a-new-programmer-kicks-a-roadblock/">A New Programmer Kicks a Roadblock</a></h1><span class="post__lang-tag font__ui">en</span></div><div lang="zh" class="post__meta font__ui">2022-09-20 | <span class="post__meta-categories"><a href="/categories/Tech/">Tech</a></span></div><div data-post-id="6ca12b0126709e68a6c02631118d4f0062378dddc9fc1baf07a7c7dff645f68f" class="post__content font__body"><p>The time I composed my first program can be back to my junior high school age. It was the first day of PC lesson, and everybody crowded to the computer classroom. We were told to learn “programming” there. The kids who were talented would be selected and trained for OI . Others instead would go to an ordinary class and learn something more general.</p><p>I was anxious. Before the time I had no concept of what “programming” is, nor had I ever gone through a <em>real</em> PC lesson. The PC lesson in my primary school barely taught anything. Over the time the teachers let us play games instead. I could type merely a dozen of characters per minute, since I’d never received a thorough typing training. I was ignorant of inside the metal box. I was a complete computer idiot.</p></div><div lang="zh" class="post__readmore font__ui"><a href="/a-new-programmer-kicks-a-roadblock/">READ MORE</a></div></article><article lang="en" class="post"><div class="post__title-block"><h1 class="post__title"><a href="/dart-go-git-package-spec/">Git-based Dependencies in Dart and Go</a></h1><span class="post__lang-tag font__ui">en</span></div><div lang="zh" class="post__meta font__ui">2022-07-05 | <span class="post__meta-categories"><a href="/categories/Memo/">Memo</a></span></div><div data-post-id="81f48703d8f319fcdbae8683d393818ed927ac7da49f5938910e7b9c9e4d1740" class="post__content font__body"><p>Both Dart and Go support decentralized package distribution. One is able to directly adopt an existing git repository as dependency, easing the effort of distributing packages.</p><p>Sometimes we might expect more fine-grained control on what to pull from a git repository. For example, to lock a package’s version, we would specify a particular tag, commit or branch name to pull from. Or if it’s a mono-repo, we would choose a sub-directory from the repository root. This post summarizes how to achieve these purposes in both languages.</p></div><div lang="zh" class="post__readmore font__ui"><a href="/dart-go-git-package-spec/">READ MORE</a></div></article><article lang="en" class="post"><div class="post__title-block"><h1 class="post__title"><a href="/reversy-naming/">Reversy Naming</a></h1><span class="post__lang-tag font__ui">en</span></div><div lang="zh" class="post__meta font__ui">2022-06-21 | <span class="post__meta-categories"><a href="/categories/Tech/">Tech</a></span></div><div data-post-id="c98bc65f255bc3f7ab74b77dfac0172aa5f4e31debdfd24301fe4885c46fc0f5" class="post__content font__body"><p>I am always a dedicated fan of writing naturally readable code – by “naturally readable” I mean, one can read a line of code as if it were a sentence of English (or maybe other human languages). It’s believed that the practice encourages more self-explainable code, as the code reads more like a human-composed article, instead of some gibberish only recognizable by machine.</p><p>The practice recommends to name functions or variables following the word order of human language, for English that is, subjects come after verbs, and adjectives go before nouns that being modified. The samples below showcase how it guides naming in a program (please hold your opinions about the casing)</p><ul><li><code>append_to_list(lst, item)</code>. A function that appends an item to a list, which can read as “append to the list (specified by name <code>lst</code>) with the item”.</li><li><code>register_service_notifier(func)</code>. A function that registers another function as a service notifier, which can read as “register a service notifier with the function <code>func</code>“.</li><li><code>UserFollowersListView</code>. The name of a web component which is a list view to display followers for a user.</li></ul><p class="nomargin">It plays well and improves my developing experience most of the time, but there is no silver bullet, just like other practices or guidelines.Sometimes I found the readability even degrades. I kept skimming the lines and just couldn’t locate an item efficiently.</p></div><div lang="zh" class="post__readmore font__ui"><a href="/reversy-naming/">READ MORE</a></div></article><article lang="zh" class="post"><div class="post__title-block"><h1 class="post__title"><a href="/human-sucks/">人类一败涂地</a></h1><span class="post__lang-tag font__ui">zh</span></div><div lang="zh" class="post__meta font__ui">2022-05-14 | <span class="post__meta-categories"><a href="/categories/Soliloquy/">Soliloquy</a></span></div><div data-post-id="460eba829e507b677aa4f28d36a9c29784b23cd8cee046bc26c6a43ee880bf49" class="post__content font__body"><p>轻微的一阵异响。面前说话的她随即模糊起来，声音也渐渐远去，趋于缥缈。我这才注意到从一开始就没有看清她的脸——原来只是个梦罢了。意识跌落回现实。我又重新感受到了我的双腿，久坐后腰的酸痛，最后是沉重的眼皮。睁开眼，还是熟悉的银色舷窗。</p><p>窗外的天王星已经很大了。坐了这么多次，光看天王星的大小也能知道到哪了，估计还得两个小时才能下船。我伸了个懒腰，腿上的便携式电脑悠了起来，屏幕被点亮了。光标停在了讲稿的最后一行，冷冷地跳动着。</p><p>再读一遍吧。到那边可有得我忙的。</p><p>周围的人大多和我一样，要么在闭目养神，要么在低头对着电脑，大家都一言不发。长途旅行最能磨去一个人的精气，但为了工作我不得不奔波于各个星球之间——真是个乏味的时代。但有一个人不一样。</p><p>“孩子，那就是天王星了吧？”</p></div><div lang="zh" class="post__readmore font__ui"><a href="/human-sucks/">READ MORE</a></div></article><article lang="en" class="post"><div class="post__title-block"><h1 class="post__title"><a href="/invalid-pointer-will-bite-you/">Invalid Golang Pointers Can Bite You Even If You Don't Dereference</a></h1><span class="post__lang-tag font__ui">en</span></div><div lang="zh" class="post__meta font__ui">2022-04-19 | <span class="post__meta-categories"><a href="/categories/Tech/">Tech</a></span></div><div data-post-id="6321ba204d8e3785fa9e839f6466d9635d6df84cae1db4b69c9ae47414ec31e8" class="post__content font__body"><p>In Golang, if you coerce a <code>uintptr</code> variable into <code>unsafe.Pointer</code> (or further, to some <code>*T</code>), the linter will warn with the message <code>&quot;possible miuse of unsafe.Pointer&quot;</code>. This makes sense because the <code>uintptr</code> variable may contain an address that points to a piece of invalid memory, and dereferencing such a pointer is catastrophic (usually aborts the program).</p><p>I was always aware of the above discipline, but I thought it would be OK to hold the pointers but not dereference them. This is true in C/C++, but not for Golang, which I did not realize until recently.</p><p>In fact, <strong>the program can panic even if you just keep an invalid pointer on the stack!</strong></p></div><div lang="zh" class="post__readmore font__ui"><a href="/invalid-pointer-will-bite-you/">READ MORE</a></div></article><article lang="zh" class="post"><div class="post__title-block"><h1 class="post__title"><a href="/side-project/">Side Project（副业）</a></h1><span class="post__lang-tag font__ui">zh</span></div><div lang="zh" class="post__meta font__ui">2022-04-12 | <span class="post__meta-categories"><a href="/categories/Soliloquy/">Soliloquy</a></span></div><div data-post-id="e9b979feee39b1bae56270f23ee6d56e57794525cc175ab3224d9846cb208c01" class="post__content font__body"><p>计算机从业者们似乎都喜欢写 side project，这在中文社区中有个通俗的说法即「搞副业」。如果你经常逛 V2EX、Reddit 的编程板块或是 Hacker News，你会看到人们分享的各种各样的 side project，小到一个百余行代码的实用小工具，大至一个框架、一个网站乃至一个完整的准商业项目。</p><p>人们在分享自己的创造时往往怀着极大的热情。这是一种即使隔着屏幕也能感受到的心情，就像七岁的男孩组装好了第一辆四驱车，又或是料理爱好者凭自己的努力烧了一顿高难度的饭菜。他们分享的是自己的宝贝，并期望在人群中掀起波澜。在一些社区如 <a target="_blank" rel="noopener" href="https://www.reddit.com/r/rust/">r/rust</a>，人们热衷于讨论这样的分享，给予肯定以及有意义的反馈。但事情并不总是如意，在另外一些地方，如综合性的或是冷门的社区，只有少数分享会被人们注意，更多的则是被略过，直至沉没在信息流中。这通常会令人沮丧。</p></div><div lang="zh" class="post__readmore font__ui"><a href="/side-project/">READ MORE</a></div></article><article lang="en" class="post"><div class="post__title-block"><h1 class="post__title"><a href="/a-bug-of-promoting-complex-trait-bounds-in-rust/">A Flaw of Promoting Complex Trait Bounds in Rust</a></h1><span class="post__lang-tag font__ui">en</span></div><div lang="zh" class="post__meta font__ui">2022-03-30 | <span class="post__meta-categories"><a href="/categories/Tech/">Tech</a></span></div><div data-post-id="d930f9d181e14eb75e7a8cfc361c7e69b1201e1467cc73a76fe37d6fe6d61e5a" class="post__content font__body"><p>Days ago, for some reason, I was trying to implement a function that can polymorphize over its return type. The solution is simple, but my brain was jammed at that time, trapped in some complicated typing tricks for hours.</p><p class="nomargin">During the struggling, I coincidently ran into something that is temporarily a flaw in the current Rust compiler implementation. In some cases, the compiler is not smart enough to promote known trait bounds, and we have to replicate them again and again. Although the problem is afterwards proved to be a useless “X-Y Problem”, I would still like to share the story.</p></div><div lang="zh" class="post__readmore font__ui"><a href="/a-bug-of-promoting-complex-trait-bounds-in-rust/">READ MORE</a></div></article><article lang="en" class="post"><div class="post__title-block"><h1 class="post__title"><a href="/initialize-pool-worker-with-individual-values/">Initialize Process Pool Worker with Individual Value</a></h1><span class="post__lang-tag font__ui">en</span></div><div lang="zh" class="post__meta font__ui">2022-03-21 | <span class="post__meta-categories"><a href="/categories/Tech/">Tech</a></span></div><div data-post-id="4452bc2ebcdbd64a4469b134fd2cc88f05f5a877f877a8a8ce2b9d3a929d6ece" class="post__content font__body"><p>There could be scenes when you are using <code>multiprocessing.pool.Pool</code> and you want to perform some initialization for each worker before tasks are scheduled via <code>Pool.map()</code> or something alike. For example, you create a pool of 4 workers, each for one GPU, and expect tasks scheduled on Worker-i to precisely utilize GPU-i. In this case, Worker-i should be initialized with env var <code>CUDA_VISIBLE_DEVICES=&lt;i&gt;</code> set.</p><p>To initialize spawned workers, the constructor of <code>Pool</code> provides two arguments concerning the job <sup id="fnref:1"><a href="#fn:1">1</a></sup> – <code>initializer</code> and <code>initargs</code>. <code>initializer</code> is expected to be a callable, and if specified, each worker process will call <code>initializer(*initargs)</code> when it starts.</p><div class="gk-code hljs" data-gk-id="BLOCK1"><div class="gk-code-display"><pre><span class="line"><span class="hljs-keyword">import</span> multiprocessing <span class="hljs-keyword">as</span> mp</span><br><span class="line"><span class="hljs-keyword">import</span> multiprocessing.pool <span class="hljs-keyword">as</span> mpp</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">def</span> <span class="hljs-title function_">worker</span>(<span class="hljs-params">arg1</span>):</span><br><span class="line">    <span class="hljs-built_in">print</span>(arg1)</span><br><span class="line"></span><br><span class="line">mpp.Pool(processes=<span class="hljs-number">2</span>, initializer=worker, initargs=(<span class="hljs-number">42</span>, ))</span><br><span class="line"><span class="hljs-comment"># 42</span></span><br><span class="line"><span class="hljs-comment"># 42</span></span><br></pre></div></div><p class="par">This is, however, slightly away from what we expect. The <code>initializer</code> is called with same arguments in each worker, while in our case, the arguments are expected to be different, like value <code>1</code> for Worker-0 and value <code>1</code> for Worker-1. There are two approaches to do the tricks.</p><h2 id="use-a-queue">Use a Queue</h2><p><code>Queue</code> and <code>SimpleQueue</code> types in module <code>multiprocessing</code> <sup id="fnref:2"><a href="#fn:2">2</a></sup> implement multi-producer, multi-consumer FIFO queues under the multi-processing scenario. We may create and share a queue among parent and worker processes, send individual values from parent processes and read them from workers. Since the sending and receiving operations are synchronized, we won’t run into any race conditions.</p><div class="gk-code hljs" data-gk-id="BLOCK2"><div class="gk-code-display"><pre><span class="line"><span class="hljs-keyword">def</span> <span class="hljs-title function_">worker</span>(<span class="hljs-params">q</span>):</span><br><span class="line">    <span class="hljs-built_in">print</span>(q.get())</span><br><span class="line"></span><br><span class="line">q = mp.SimpleQueue()</span><br><span class="line">p = mpp.Pool(processes=<span class="hljs-number">2</span>, initializer=worker, initargs=(q,))</span><br><span class="line"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>):</span><br><span class="line">    q.put(i)</span><br><span class="line">p.close()</span><br><span class="line"><span class="hljs-comment"># 0</span></span><br><span class="line"><span class="hljs-comment"># 1</span></span><br></pre></div></div><h2 id="use-a-value">Use a Value</h2><p>Alternatively, we may use a lighter shared object other than a queue. The <code>Value</code> type in module <code>multiprocessing</code> <sup id="fnref:3"><a href="#fn:3">3</a></sup> allows sharing simple values across multiple processes. It can also synchronize accesses to values to avoid race conditions if necessary. We can use a <code>Value</code> object to allocate an individual id for each worker process.</p><div class="gk-code hljs" data-gk-id="BLOCK3"><div class="gk-code-display"><pre><span class="line"><span class="hljs-keyword">def</span> <span class="hljs-title function_">worker</span>(<span class="hljs-params">v</span>):</span><br><span class="line">    <span class="hljs-keyword">with</span> v.get_lock():</span><br><span class="line">        val = v.value</span><br><span class="line">        v.value += <span class="hljs-number">1</span></span><br><span class="line">    <span class="hljs-built_in">print</span>(val)</span><br><span class="line"></span><br><span class="line">v = mp.Value(ctypes.c_int32, <span class="hljs-number">0</span>, lock=<span class="hljs-literal">True</span>)</span><br><span class="line">p = mpp.Pool(processes=<span class="hljs-number">2</span>, initializer=worker, initargs=(v,))</span><br><span class="line">p.close()</span><br><span class="line"><span class="hljs-comment"># 0</span></span><br><span class="line"><span class="hljs-comment"># 1</span></span><br></pre></div></div><div class="footnotes"><ol><li class="footnote" id="fn:1"><a target="_blank" rel="noopener" href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.pool.Pool">https://docs.python.org/3/library/multiprocessing.html#multiprocessing.pool.Pool</a></li><li class="footnote" id="fn:2"><a target="_blank" rel="noopener" href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.Queue">https://docs.python.org/3/library/multiprocessing.html#multiprocessing.Queue</a></li><li class="footnote" id="fn:3"><a target="_blank" rel="noopener" href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.Value">https://docs.python.org/3/library/multiprocessing.html#multiprocessing.Value</a></li></ol></div></div><div lang="zh" class="post__readmore font__ui"><a href="/initialize-pool-worker-with-individual-values/">READ MORE</a></div></article><article lang="en" class="post"><div class="post__title-block"><h1 class="post__title"><a href="/rust-python-ffi-from-scratch/">Rust - Python FFI From Scratch</a></h1><span class="post__lang-tag font__ui">en</span></div><div lang="zh" class="post__meta font__ui">2022-03-12 | <span class="post__meta-categories"><a href="/categories/Tech/">Tech</a></span></div><div data-post-id="0cce240ad0da20c647df69ab7008c714d9d42102a86c55ba1e04af5046b20c10" class="post__content font__body"><p>I was recently working on a side project that involves communication between binaries written in Rust and web interfaces written in Python. Moving a part of my project onto a language like Rust is under several considerations: <em>1)</em> the logic is all about manipulating byte arrays, where Python has deficit and system language like Rust is superior; <em>2)</em> the logic happens to be complicated, I need a static type system to ensure the correctness, and also the <code>match</code> expression of Rust is found helpful in getting things concise; <em>3)</em> I was planning to develop CLI tools with Rust, which calls this fraction of functionality, and I don’t want to rewrite the stuff in the future.</p></div><div lang="zh" class="post__readmore font__ui"><a href="/rust-python-ffi-from-scratch/">READ MORE</a></div></article><article lang="en" class="post"><div class="post__title-block"><h1 class="post__title"><a href="/extending-hexo-better-mathjax-rendering/">[Extending Hexo For My Site] Part 1 - Better Mathjax Rendering</a></h1><span class="post__lang-tag font__ui">en</span></div><div lang="zh" class="post__meta font__ui">2022-01-03 | <span class="post__meta-categories"><a href="/categories/Tech/">Tech</a></span></div><div data-post-id="b07a3e7ca71541ace092beda71af32efd96c5fd0bfef0ebf6ec760009717576e" class="post__content font__body"><p>I am a heavy user of <a target="_blank" rel="noopener" href="https://www.mathjax.org/">Mathjax</a>. Mathjax is a library that renders Tex-compatible syntax into pretty equations in web scenarios. Hence I am always mixing up Markdown and Tex snippets in my writing. The annoying part is Tex snippets have low priority in my Markdown renderer, and are sometimes incorrectly rendered into Markdown elements. For instance, <code>$a_1, a_2$</code> becomes <code>$a<em>1, a</em>2$</code>, where underscores within <code>$...$</code> are mistakenly recognized as an emphasis element. A bunch of escaping is required to avoid the situation, which drives me mad. So I got to seek a permanant solution.</p></div><div lang="zh" class="post__readmore font__ui"><a href="/extending-hexo-better-mathjax-rendering/">READ MORE</a></div></article></div><div lang="zh" class="page-navigator font__ui"><span class="page__button"><a href="/page/3/" class="pre">PREV</a></span><span class="page__button"><a href="/page/5/" class="next">NEXT</a></span></div></main><section class="aside__group"><span class="aside__btn"><div lang="zh" class="github-btn"><a href="#" rel="noopener noreferrer" target="_blank" class="gh-btn"><span class="gh-ico"></span><span class="gh-text">FOLLOW ME</span></a><a href="#" rel="noopener noreferrer" target="_blank" class="gh-count"></a></div><script>window.GH_BUTTON={username:"hsfzxjy"}</script></span><aside class="aside__left"><div class="aside__menuList"><span class="aside__menuList-item__icon current"><i class="icon-home"></i></span><a href="/" class="aside__menuList-item current"><span lang="zh" class="font__ui">首页 / Home</span></a><span class="aside__menuList-item__icon"><i class="icon-embed2"></i></span><a href="/categories/Tech/" class="aside__menuList-item"><span lang="zh" class="font__ui">科技 / Tech</span></a><span class="aside__menuList-item__icon"><i class="icon-android"></i></span><a href="/categories/Soliloquy/" class="aside__menuList-item"><span lang="zh" class="font__ui">呓语 / Soliloquy</span></a><span class="aside__menuList-item__icon"><i class="icon-leaf"></i></span><a href="/categories/Life/" class="aside__menuList-item"><span lang="zh" class="font__ui">生活 / Life</span></a><span class="aside__menuList-item__icon"><i class="icon-bookmarks"></i></span><a href="/categories/Memo/" class="aside__menuList-item"><span lang="zh" class="font__ui">速记 / Memo</span></a><span class="aside__menuList-item__icon"><i class="icon-books"></i></span><a href="/categories/Series/" class="aside__menuList-item"><span lang="zh" class="font__ui">连载 / Series</span></a><span class="aside__menuList-item__icon"><i class="icon-sigma"></i></span><a href="/works/" class="aside__menuList-item"><span lang="zh" class="font__ui">项目 / Projects</span></a><span class="aside__menuList-item__icon"><i class="icon-earth"></i></span><a href="/links/" class="aside__menuList-item"><span lang="zh" class="font__ui">友链 / Links</span></a><span class="aside__menuList-item__icon"><i class="icon-wink"></i></span><a href="/about/" class="aside__menuList-item"><span lang="zh" class="font__ui">关于 / About</span></a><span class="aside__menuList-item__icon"><i class="icon-history"></i></span><a href="/aggr/" class="aside__menuList-item"><span lang="zh" class="font__ui">索引 / Index</span></a><span class="aside__menuList-item__icon"><i class="icon-rss2"></i></span><a href="/rss.xml" class="aside__menuList-item"><span lang="zh" class="font__ui">订阅 / RSS</span></a></div></aside><aside class="aside__right"></aside></section><div id="footer" style="text-align:center" lang="zh" class="font__ui">© <a href="/" rel="nofollow">hsfzxjy 的博客.</a>&nbsp;Powered by&nbsp;<a rel="nofollow" target="_blank" href="https://hexo.io">Hexo.</a>&nbsp;<a rel="nofollow" target="_blank" href="https://github.com/hsfzxjy/byak-hexo">Theme</a>&nbsp;by&nbsp;<a rel="nofollow" target="_blank" href="https://github.com/hsfzxjy">hsfzxjy</a>.<div style="margin-top:10px"><a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44011202001249" style="display:inline-block;text-decoration:none;height:20px;line-height:20px"><img src="/img/beian.png" style="float:left" loading="lazy"><span style="float:left;height:20px;line-height:20px;margin:0 0 0 5px;color:#939393">粤公网安备44011202001249号</span></a><a target="_blank" style="display:inline-block;text-decoration:none;height:20px;line-height:20px" href="http://beian.miit.gov.cn/"><span style="float:left;height:20px;line-height:20px;margin:0 0 0 5px;color:#939393">粤ICP备2020075702号-1</span></a></div></div></body><script src="/dist/js/main.js" async defer></script></html>