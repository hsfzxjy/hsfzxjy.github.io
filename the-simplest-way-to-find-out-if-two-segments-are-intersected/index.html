<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=5" name="viewport"><meta content="yes" name="mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><script>(()=>{let r="/cnfonts.js",n=document,e=n.createElement("link");e.rel="stylesheet",e.href="/fontchan/jBKCaHQX.css",e.blocking="render",e.onerror=()=>{var e=n.createElement("script");e.src=r,e.onload=()=>$fontchan.injectCss(),n.head.appendChild(e)},n.head.appendChild(e),"serviceWorker"in navigator&&navigator.serviceWorker.register(r,{scope:"/"}).then(e=>e.update())})()</script><title>数学美 之 判断线段相交的最简方法</title><meta itemprop="title" content="数学美 之 判断线段相交的最简方法 - hsfzxjy 的博客"><meta itemprop="og:title" content="数学美 之 判断线段相交的最简方法 - hsfzxjy 的博客"><meta itemprop="image" content="https://i.hsfzxjy.site/avatar-for-hsfzxjy.jpg"><meta itemprop="og:image" content="https://i.hsfzxjy.site/avatar-for-hsfzxjy.jpg"><meta itemprop="description" content="
 解析几何的巅峰
是 向量
那无关过程的狂妄与简洁
映射着大自然无与伦比的美

引子
如何判断两条直线是否相交？..."><meta itemprop="og:type" content="website"><link rel="stylesheet" href="/dist/css/style.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="alternate" type="application/rss+xml" href="/rss.xml"></head><body><nav class="nav"><span class="nav__toggler"><span class="nav__toggler-bar bar1"></span><span class="nav__toggler-bar bar2"></span><span class="nav__toggler-bar bar3"></span></span><span class="nav__core"><div class="nav__logo"><img src="/avatar.webp" loading="lazy"></div><a href="/" lang="zh" class="nav__brand">hsfzxjy</a></span><span class="nav__togglerClose"><span class="nav__togglerClose-circle"></span><span class="nav__togglerClose-bar bar1"></span><span class="nav__togglerClose-bar bar2"></span></span><div class="nav__pathIndicator"><a href="/categories/Tech/">Tech</a></div></nav><main class="mainContainer"><div lang="zh" class="post post-page"><h1 lang="zh" class="post__title">数学美 之 判断线段相交的最简方法</h1><div class="post__meta font__ui">2016-02-19 | <span class="post__meta-categories"><a href="/categories/Tech/">Tech</a></span></div><div class="post__content font__body"><blockquote><p class="par">解析几何的巅峰 是 向量 那无关过程的狂妄与简洁 映射着大自然无与伦比的美</p></blockquote><h2 id="引子-1">引子</h2><p>如何判断两条直线是否相交？</p><p>这很容易。平面直线，无非就是两种关系：相交 或 平行。因此，只需判断它们是否平行即可。而直线平行，等价于它们的斜率相等，只需分别计算出它们的斜率，即可做出判断。</p><p>但倘若我把“直线”换成“线段”呢——如何判断两条线段是否相交？</p><p>这就有些难度了。和 直线 不同，线段 是有固定长度的，即使它们所属的两条直线相交，这两条线段也不一定相交。</p><p>也许你会说：分情况讨论不就行了嘛：</p><ul><li>先计算两条线段的斜率，判断是否平行。若平行，则一定不相交。</li><li>若不平行，求出两条线段的直线方程，联立之，解出交点坐标。</li><li>运用定比分点公式，判断交点是否在两条线段上。</li></ul><p>的确，从理论上这是一个可行的办法，这也是人们手动计算时普遍采用的方法。</p><p>然而，这个方法并不怎么适用于计算机。原因如下：</p><ul><li>计算中出现了除法（斜率计算、定比分点），因此每次计算前都要判断除数是否为 0（或接近 0）。这很麻烦，严重干扰逻辑的表达。</li><li>浮点精度丢失带来的误差。人类计算时可以采用分数，但计算机不行。计算机在储存浮点数时会有精度丢失的现象。一旦算法的计算量大起来，误差会被急剧放大，影响结果准确性。</li><li>效率低下。浮点乘除会十分耗时，不适用于对实时性要求较高的生产环境（如 游戏）。</li></ul><p class="noindent">那么，有更好的方法？</p><p class="noindent">当然有。</p><h2 id="类型预定义">类型预定义</h2><p>本文的算法将用 python 描述，主要用到两个数据类型：</p><div class="gk-code hljs" data-gk-id="BLOCK1"><div class="gk-code-display"><pre><span class="line"><span class="hljs-comment"># 点</span></span><br><span class="line"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Point</span>(<span class="hljs-title class_ inherited__">object</span>):</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, x, y</span>):</span><br><span class="line">        self.x, self.y = x, y</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 向量</span></span><br><span class="line"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Vector</span>(<span class="hljs-title class_ inherited__">object</span>):</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, start_point, end_point</span>):</span><br><span class="line">        self.start, self.end = start_point, end_point</span><br><span class="line">        self.x = end_point.x - start_point.x</span><br><span class="line">        self.y = end_point.y - start_point.y</span><br></pre></div></div><p class="par">先在此处说明。</p><h2 id="问题分析">问题分析</h2><p>对于“判断两条直线是否相交”这个问题，我们之所以能迅速而准确地进行判断，是因为“相交”与“不相交”这两个状态有着明显的不同点，即 <strong>斜率是否相等</strong>。</p><p>那么现在，为了判断两条线段是否相交，我们也要找出“相交”与“不相交”这两个状态的不同点。</p><p>假设现在有两条线段 AB 和 CD，我们画出它们之间的三种关系：</p><ol><li><img loading="lazy" src="https://segmentfault.com/img/bVsRnf" alt="不相交"></li><li><img loading="lazy" src="https://segmentfault.com/img/bVsRmQ" alt="交点位于某条线段上"></li><li><img loading="lazy" src="https://segmentfault.com/img/bVsRnh" alt="相交"></li></ol><p>其中，情况 1 为不相交，情况 2、3 为相交。</p><p>作出向量 AC、AD、BC、BD。</p><p>首先介绍一个概念： <strong>向量有序对的旋转方向</strong>。这个概念指：对于共起点有序向量二元组<code>(a, b)</code>，其旋转方向为 <strong>使 a 能够旋转一个小于 180 度的角并与 b 重合的方向</strong>，简记为 <code>direct(a, b)</code>。若 <code>a</code> 和 <code>b</code> 反向共线，则旋转方向取任意值。</p><p>举个例子：图一中，<code>direct(AC, AD)</code> 为顺时针方向。</p><p>接下来我们要分析四个值：<code>direct(AC, AD)</code>、<code>direct(BC, BD)</code>、<code>direct(CA, CB)</code>、<code>direct(DA, DB)</code>。</p><ol><li>对于图一，<code>direct(AC, AD)</code> 和 <code>direct(BC, BD)</code> 都为顺时针，<code>direct(CA, CB)</code> 为逆时针，<code>direct(DA, DB)</code> 为顺时针。</li><li>对于图二，<code>direct(AC, AD)</code> 为顺时针，<code>direct(BC, BD)</code> 为任意方向，<code>direct(CA, CB)</code> 为逆时针，<code>direct(DA, DB)</code> 为顺时针。</li><li>对于图三，<code>direct(AC, AD)</code>、<code>direct(DA, DB)</code> 为顺时针，<code>direct(BC, BD)</code>、<code>direct(CA, CB)</code> 为逆时针。</li></ol><p>不难发现，两条线段相交的充要条件是：<code>direct(AC, AD) != direct(BC, BD)</code> 且 <code>direct(CA, CB) != direct(DA, DB)</code>。这便是“相交”与“不相交”这两个状态的不同点。</p><p>然而你可能会觉得：旋转方向这么一个虚无飘渺的东西，怎么用程序去描述啊？</p><p>再来看一幅图：</p><p><img loading="lazy" src="https://segmentfault.com/img/bVsRna" alt=""></p><p>再来定义有向角：</p><blockquote><p>有向角 <code>&lt;a, b&gt;</code> 为 向量<code>a</code> <strong>逆时针</strong> 旋转到与 向量<code>b</code> 重合所经过的角度。</p></blockquote><p>不难看出，对于向量<code>a</code>、<code>b</code>：</p><ul><li>若 <code>direct(a, b)</code> 为逆时针，则 <code>0 &lt;= &lt;a, b&gt; &lt;= 180</code>，从而 <code>sin&lt;a, b&gt; &gt;= 0</code>。</li><li>若 <code>direct(a, b)</code> 为顺时针，则 <code>180 &lt;= &lt;a, b&gt; &lt;= 360</code>，从而 <code>sin&lt;a, b&gt; &lt;= 0</code>。</li></ul><p>这样一来，我们可以将旋转方向的问题转化为 <strong>求有向角正弦值</strong> 的问题。而这个问题，是很容易的。</p><p>如上图，记</p><p>$$ OA = (x_1, y_1), OB = (x_2, y_2) $$ $$ |OA| = r_1, |OB| = r_2 $$</p><p>则</p><p>$$ sin(\lt OA, OB\gt) $$ $$ = sin \theta $$ $$ = sin (\beta - \alpha) $$ $$ = sin \beta cos \alpha - sin \alpha cos \beta $$ $$ = \frac{(sin \beta cos \alpha - sin \alpha cos \beta) r_1 r_2}{r_1 r_2} $$ $$ = {(x_1 y_2 - x_2 y_1) \over (r_1 r_2)} $$</p><p>而这里，我们要的只是 <code>sin(&lt;OA, OB&gt;)</code> 的符号，而 <code>r1</code> 和 <code>r2</code> 又都是恒正的，因此只需判断 <code>x1 * y2 - x2 * y1</code> 的符号即可。</p><p>这个方法的数学背景是 <strong>叉乘</strong>，可以前往 <a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%90%91%E9%87%8F%E7%A7%AF">Wikipedia</a> 了解更多。</p><h2 id="思路小结">思路小结</h2><ul><li>由点 A，B，C，D 计算出向量 AC，AD，BC，BD</li><li>计算 <code>sin(&lt;AC, AD&gt;) * sin(&lt;BC, BD&gt;)</code> 和 <code>sin(&lt;CA, CB&gt;) * sin(&lt;DA, DB&gt;)</code>，若皆为非正数，则相交；否则，不相交。</li></ul><h2 id="实现-1">实现</h2><p>终于到代码部分了，想必大家都已不耐烦了吧。</p><p>在向量的辅助下，代码显得异常简单。</p><div class="gk-code hljs" data-gk-id="BLOCK2"><div class="gk-code-display"><pre><span class="line">ZERO = <span class="hljs-number">1e-9</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">def</span> <span class="hljs-title function_">negative</span>(<span class="hljs-params">vector</span>):</span><br><span class="line">    <span class="hljs-string">&quot;&quot;&quot;取反&quot;&quot;&quot;</span></span><br><span class="line">    <span class="hljs-keyword">return</span> Vector(vector.end_point, vector.start_point)</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">def</span> <span class="hljs-title function_">vector_product</span>(<span class="hljs-params">vectorA, vectorB</span>):</span><br><span class="line">    <span class="hljs-string">&#x27;&#x27;&#x27;计算 x_1 * y_2 - x_2 * y_1&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="hljs-keyword">return</span> vectorA.x * vectorB.y - vectorB.x * vectorA.y</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">def</span> <span class="hljs-title function_">is_intersected</span>(<span class="hljs-params">A, B, C, D</span>):</span><br><span class="line">    <span class="hljs-string">&#x27;&#x27;&#x27;A, B, C, D 为 Point 类型&#x27;&#x27;&#x27;</span></span><br><span class="line">    AC = Vector(A, C)</span><br><span class="line">    AD = Vector(A, D)</span><br><span class="line">    BC = Vector(B, C)</span><br><span class="line">    BD = Vector(B, D)</span><br><span class="line">    CA = negative(AC)</span><br><span class="line">    CB = negative(BC)</span><br><span class="line">    DA = negative(AD)</span><br><span class="line">    DB = negative(BD)</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">return</span> (vector_product(AC, AD) * vector_product(BC, BD) &lt;= ZERO) \</span><br><span class="line">        <span class="hljs-keyword">and</span> (vector_product(CA, CB) * vector_product(DA, DB) &lt;= ZERO)</span><br></pre></div></div><p>一气呵成，没有恼人的除法，没有情况讨论，只是纯粹的简单运算。</p><br><blockquote><p class="cc">作者：hsfzxjy<br>链接：<span class="cc-link"></span><br>许可：<a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/">CC BY-NC-ND 4.0</a>.<br>著作权归作者所有。本文<b>不允许</b>被用作商业用途，非商业转载请注明出处。</p></blockquote><script>!function(){var n=document.querySelector("span.cc-link");n&&(n.innerHTML='<a href="'+location.href+'">'+location.href+"</a>")}()</script></div><div class="post__tags"></div><div class="post-nav"><a href="/python-generator-coroutine/" class="pre">«Python“黑魔法”之 Generator Coroutines</a><a href="/thinking-in-the-day-before-lunar-new-year-of-2016/" class="next">除夕杂感»</a></div><div id="disqus_thread"><div id="no-comment"><h2>OOPS!</h2><span>A comment box should be right here...</span><span>But it was gone due to network issues :-(</span><span>If you want to leave comments, make sure you have access to&nbsp;<a target="_blank" rel="noopener" href="https://disqus.com">disqus.com</a>.</span></div><script>var disqus_shortname="hsfzxjy",disqus_identifier="the-simplest-way-to-find-out-if-two-segments-are-intersected/",disqus_title="数学美 之 判断线段相交的最简方法",disqus_url="https://i.hsfzxjy.site/the-simplest-way-to-find-out-if-two-segments-are-intersected/";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.defer=!0,e.src="https://"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("body")[0]||document.getElementsByTagName("head")[0]).appendChild(e),e.onerror=function(){document.getElementById("no-comment").classList.add("show")}}()</script><script id="dsq-count-scr" src="//hsfzxjy.disqus.com/count.js" async defer></script></div></div></main><section class="aside__group"><span class="aside__btn"><div lang="zh" class="github-btn"><a href="#" rel="noopener noreferrer" target="_blank" class="gh-btn"><span class="gh-ico"></span><span class="gh-text">FOLLOW ME</span></a><a href="#" rel="noopener noreferrer" target="_blank" class="gh-count"></a></div><script>window.GH_BUTTON={username:"hsfzxjy"}</script></span><aside class="aside__left"><div class="aside__menuList"><span class="aside__menuList-item__icon"><i class="icon-home"></i></span><a href="/" class="aside__menuList-item"><span lang="zh" class="font__ui">首页 / Home</span></a><span class="aside__menuList-item__icon current"><i class="icon-embed2"></i></span><a href="/categories/Tech/" class="aside__menuList-item current"><span lang="zh" class="font__ui">科技 / Tech</span></a><span class="aside__menuList-item__icon"><i class="icon-android"></i></span><a href="/categories/Soliloquy/" class="aside__menuList-item"><span lang="zh" class="font__ui">呓语 / Soliloquy</span></a><span class="aside__menuList-item__icon"><i class="icon-leaf"></i></span><a href="/categories/Life/" class="aside__menuList-item"><span lang="zh" class="font__ui">生活 / Life</span></a><span class="aside__menuList-item__icon"><i class="icon-bookmarks"></i></span><a href="/categories/Memo/" class="aside__menuList-item"><span lang="zh" class="font__ui">速记 / Memo</span></a><span class="aside__menuList-item__icon"><i class="icon-books"></i></span><a href="/categories/Series/" class="aside__menuList-item"><span lang="zh" class="font__ui">连载 / Series</span></a><span class="aside__menuList-item__icon"><i class="icon-sigma"></i></span><a href="/works/" class="aside__menuList-item"><span lang="zh" class="font__ui">项目 / Projects</span></a><span class="aside__menuList-item__icon"><i class="icon-earth"></i></span><a href="/links/" class="aside__menuList-item"><span lang="zh" class="font__ui">友链 / Links</span></a><span class="aside__menuList-item__icon"><i class="icon-wink"></i></span><a href="/about/" class="aside__menuList-item"><span lang="zh" class="font__ui">关于 / About</span></a><span class="aside__menuList-item__icon"><i class="icon-history"></i></span><a href="/aggr/" class="aside__menuList-item"><span lang="zh" class="font__ui">索引 / Index</span></a><span class="aside__menuList-item__icon"><i class="icon-rss2"></i></span><a href="/rss.xml" class="aside__menuList-item"><span lang="zh" class="font__ui">订阅 / RSS</span></a></div></aside><aside class="aside__right"><div id="toc" lang="zh" class="font__body"><div class="toc-toggler"></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E5%AD%90-1"><span class="toc-number">1.</span> <span class="toc-text">引子</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E9%A2%84%E5%AE%9A%E4%B9%89"><span class="toc-number">2.</span> <span class="toc-text">类型预定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90"><span class="toc-number">3.</span> <span class="toc-text">问题分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF%E5%B0%8F%E7%BB%93"><span class="toc-number">4.</span> <span class="toc-text">思路小结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0-1"><span class="toc-number">5.</span> <span class="toc-text">实现</span></a></li></ol></div></div></aside></section><div id="footer" style="text-align:center" lang="zh" class="font__ui">© <a href="/" rel="nofollow">hsfzxjy 的博客.</a>&nbsp;Powered by&nbsp;<a rel="nofollow" target="_blank" href="https://hexo.io">Hexo.</a>&nbsp;<a rel="nofollow" target="_blank" href="https://github.com/hsfzxjy/byak-hexo">Theme</a>&nbsp;by&nbsp;<a rel="nofollow" target="_blank" href="https://github.com/hsfzxjy">hsfzxjy</a>.<div style="margin-top:10px"><a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44011202001249" style="display:inline-block;text-decoration:none;height:20px;line-height:20px"><img src="/img/beian.png" style="float:left" loading="lazy"><span style="float:left;height:20px;line-height:20px;margin:0 0 0 5px;color:#939393">粤公网安备44011202001249号</span></a><a target="_blank" style="display:inline-block;text-decoration:none;height:20px;line-height:20px" href="http://beian.miit.gov.cn/"><span style="float:left;height:20px;line-height:20px;margin:0 0 0 5px;color:#939393">粤ICP备2020075702号-1</span></a></div></div></body><script src="/dist/js/main.js" async defer></script></html>